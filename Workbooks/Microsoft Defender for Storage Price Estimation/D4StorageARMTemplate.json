{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "DF-Storage Cost Estimation Workbook",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "azure security center",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Microsoft Defender for Storage - Cost Estimation Workbook (includes malware scanning estimation) v4\"},\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"## This workbook is designed to provide a cost estimate for Microsoft Defender for Storage. The estimate includes the estimated cost of scanning for malware upon upload.\"},\"name\":\"text - 14\"},{\"type\":1,\"content\":{\"json\":\"### Cost of Microsoft Defender for storage\\r\\n\\r\\nThe cost is $10 per storage account per month. However, storage accounts with an exceptionally high transaction volume (above 73 million monthly transactions) will incur an overage charge of $0.1492 per 1 million transactions for transactions that exceed the 73 million threshold.\\r\\n\\r\\nPlease note that the actual pricing may vary based on the type of agreement made with Microsoft, the date of purchase, and the currency exchange rate. For more detailed information, please visit the [Defender for Cloud pricing](https://azure.microsoft.com/pricing/details/defender-for-cloud/) page.\",\"style\":\"info\"},\"name\":\"text - 11\"},{\"type\":1,\"content\":{\"json\":\"\\r\\n\\r\\n#### Please select the scope:\\r\\nDue to Azure Monitorâ€™s limitations, please limit your selection of subscriptions and storage accounts as it can only display up to 250 rows.\"},\"name\":\"text - 11\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscriptions}\"],\"parameters\":[{\"id\":\"2896eab7-cf93-43e5-bc43-92eba7c6bd80\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscriptions\",\"type\":6,\"description\":\"Please select one or several subscriptions to allow the workbook to calculate Defender for Cloud cost.\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"ab6fe485-f740-432f-b879-d612178179fd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Storage\",\"type\":5,\"description\":\"Please select one or several storage accounts to calculate the estimated cost for Defender for Storage\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"where type =~ 'microsoft.storage/storageaccounts'\\r\\n| order by name asc\\r\\n| extend Rank = row_number()\\r\\n| project value = id\",\"crossComponentResources\":[\"{Subscriptions}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 1\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"f0901d7f-3e94-4520-a0ba-7c0a1087a7f0\",\"cellValue\":\"SelectedView\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Defender for Storage coverage\",\"subTarget\":\"Overview\",\"preText\":\"Overview\",\"style\":\"link\"},{\"id\":\"9a8a9b40-f9e0-4963-892c-67ee3e6d4801\",\"cellValue\":\"SelectedView\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Cost estimation\",\"subTarget\":\"Storage\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"Subscriptions\",\"comparison\":\"isNotEqualTo\"},\"name\":\"Main menu\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Microsoft Defender for Storage coverage by subscriptions\"},\"name\":\"text - 1\"},{\"type\":1,\"content\":{\"json\":\"This table provides an overview of all selected subscriptions and their corresponding Defender status per plan. You can click the on/off status per plan and subscription. Doing so, you will be redirected to the subscription's Defender for Cloud plan configuration page. With that, you can easily see your Defender for Cloud coverage per subscription and immediately react in case you want to enable additional plans on it. \"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"text - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// DF-Storage Plans\\nsecurityresources\\n| where type == \\\"microsoft.security/pricings\\\"\\n| where name == \\\"StorageAccounts\\\"\\n| extend pricingTier = properties.pricingTier\\n| extend DefenderForStoragePlan = properties.subPlan\\n| extend IsInTrialPeriod = properties.freeTrialRemainingTime\\n| extend MalwareScanningEnabled = properties.extensions[0].isEnabled\\n| extend MalwareScanningCapping = properties.extensions[0].additionalExtensionProperties[\\\"CapGBPerMonthPerStorageAccount\\\"]\\n| extend SensitiveDataDiscoveryEnabled = properties.extensions[1].isEnabled\\n| extend IsEnabled = iff(pricingTier == \\\"Free\\\", \\\"Disabled\\\", \\\"Enabled\\\"), \\n    DefenderForStoragePlan  = iff(isnull(DefenderForStoragePlan ), \\\"\\\", DefenderForStoragePlan ), \\n    MalwareScanningEnabled = iff(isnull(MalwareScanningEnabled), \\\"\\\", MalwareScanningEnabled), \\n    MalwareScanningCapping = iff(isnull(MalwareScanningCapping), \\\"\\\", MalwareScanningCapping), \\n    SensitiveDataDiscoveryEnabled = iff(isnull(SensitiveDataDiscoveryEnabled), \\\"\\\", SensitiveDataDiscoveryEnabled),\\n    IsInTrialPeriod = iff(IsInTrialPeriod == \\\"PT0S\\\", \\\"\\\", \\\"Yes\\\")\\n| project subscriptionId, IsInTrialPeriod, IsEnabled, DefenderForStoragePlan, MalwareScanningEnabled, MalwareScanningCapping, SensitiveDataDiscoveryEnabled\",\"size\":3,\"showAnalytics\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true,\"customColumnWidthSetting\":\"50ch\"}},{\"columnMatch\":\"IsEnabled\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Disabled\",\"representation\":\"gray\",\"text\":\"Disabled\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"DefenderForStoragePlan\",\"formatter\":18,\"formatOptions\":{\"linkColumn\":\"subscriptionId\",\"linkTarget\":\"OpenBlade\",\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"DefenderForStorageV2\",\"representation\":\"green\",\"text\":\"New plan (v2)\"},{\"operator\":\"==\",\"thresholdValue\":\"PerStorageAccount\",\"representation\":\"lightBlue\",\"text\":\"Classic (per storage account)\"},{\"operator\":\"==\",\"thresholdValue\":\"PerTransaction\",\"representation\":\"lightBlue\",\"text\":\"Classic (v1 - per transaction)\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"gray\",\"text\":\"Disabled\"}],\"bladeOpenContext\":{\"bladeName\":\"PolicyPricingWithBundlesBlade\",\"extensionName\":\"Microsoft_Azure_Security\",\"bladeParameters\":[{\"name\":\"subscriptionId\",\"source\":\"column\",\"value\":\"subscriptionId\"}]}}},{\"columnMatch\":\"subscriptionName\",\"formatter\":5}],\"labelSettings\":[{\"columnId\":\"subscriptionId\",\"label\":\"Subscription name\"},{\"columnId\":\"IsInTrialPeriod\",\"label\":\"In trial\"},{\"columnId\":\"IsEnabled\",\"label\":\"Is enabled\"},{\"columnId\":\"DefenderForStoragePlan\",\"label\":\"DF-Storage plan\"},{\"columnId\":\"MalwareScanningEnabled\",\"label\":\"Malware scanning enabled\"},{\"columnId\":\"MalwareScanningCapping\",\"label\":\"Malware scanning cap\"},{\"columnId\":\"SensitiveDataDiscoveryEnabled\",\"label\":\"Sensitive data discovery enabled\"}]},\"sortBy\":[]},\"conditionalVisibility\":{\"parameterName\":\"SelectedView\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"query - 4\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"SelectedView\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},{\"parameterName\":\"Subscriptions\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"Overview\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscriptions}\"],\"parameters\":[{\"id\":\"5a10dfcf-57df-4e91-96f7-3363b76bc378\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"value\":{\"durationMs\":604800000},\"isHiddenWhenLocked\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":604800000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"conditionalVisibility\":{\"parameterName\":\"SelectedView\",\"comparison\":\"isEqualTo\",\"value\":\"Storage\"},\"name\":\"parameters - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":10,\"content\":{\"chartId\":\"workbookd83c695f-55f9-4cb6-a938-cf07fcd5ed0f\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":0,\"resourceType\":\"microsoft.storage/storageaccounts\",\"metricScope\":0,\"resourceParameter\":\"Storage\",\"resourceIds\":[\"{Storage}\"],\"timeContextFromParameter\":\"TimeRange\",\"timeContext\":{\"durationMs\":604800000},\"metrics\":[{\"namespace\":\"microsoft.storage/storageaccounts/blobservices\",\"metric\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Transactions\",\"aggregation\":1},{\"namespace\":\"microsoft.storage/storageaccounts/fileservices\",\"metric\":\"microsoft.storage/storageaccounts/fileservices-Transaction-Transactions\",\"aggregation\":1},{\"namespace\":\"microsoft.storage/storageaccounts/blobservices\",\"metric\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Ingress\",\"aggregation\":1,\"filters\":[{\"key\":\"ApiName\",\"operator\":0,\"values\":[\"PutBlob\",\"CopyBlob\",\"PutBlock\",\"PutBlockList\",\"PutBlockFromURL\",\"AppendFile\",\"FlushFile\",\"CreatePathFile\"]}]}],\"resourceLimit\":10000,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Subscription\",\"formatter\":5},{\"columnMatch\":\"Name\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Transactions\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":null}},{\"columnMatch\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Transactions Timeline\",\"formatter\":5},{\"columnMatch\":\"microsoft.storage/storageaccounts/fileservices-Transaction-Transactions\",\"formatter\":1,\"numberFormat\":{\"unit\":0,\"options\":null}},{\"columnMatch\":\"microsoft.storage/storageaccounts/fileservices-Transaction-Transactions Timeline\",\"formatter\":5},{\"columnMatch\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Ingress Timeline\",\"formatter\":5},{\"columnMatch\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Ingress\",\"formatter\":1,\"numberFormat\":{\"unit\":2,\"options\":null}}],\"rowLimit\":10000,\"labelSettings\":[{\"columnId\":\"Subscription\",\"label\":\"Subscription\"},{\"columnId\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Transactions\",\"label\":\"Transactions (Sum)\"},{\"columnId\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Transactions Timeline\",\"label\":\"Transactions Timeline\"},{\"columnId\":\"microsoft.storage/storageaccounts/fileservices-Transaction-Transactions\",\"label\":\"Transactions (Sum)\"},{\"columnId\":\"microsoft.storage/storageaccounts/fileservices-Transaction-Transactions Timeline\",\"label\":\"Transactions Timeline\"},{\"columnId\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Ingress\",\"label\":\"Ingress (Sum)\"},{\"columnId\":\"microsoft.storage/storageaccounts/blobservices-Transaction-Ingress Timeline\",\"label\":\"Ingress Timeline\"}]},\"exportToExcelOptions\":\"all\"},\"conditionalVisibility\":{\"parameterName\":\"{blank}\",\"comparison\":\"isEqualTo\",\"value\":\"0\"},\"name\":\"metric - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0b7480de-1a81-4cdd-9477-a13df5aec390\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DfStoragePlan\",\"label\":\"Pricing plan\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"PerStorage\\\", \\\"label\\\": \\\"Per-storage account (new plan)\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"PerStorage\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"SelectedView\",\"comparison\":\"isEqualTo\",\"value\":\"Storage\"},\"name\":\"parameters - 17\"},{\"type\":1,\"content\":{\"json\":\"#### Please be aware that the provided estimate is based on the telemetry data from your resources and standard retail pricing. Itâ€™s important to understand that this does not represent your actual billed amount. For accurate cost information, please refer to your actual billing information.\"},\"name\":\"text - 4\"},{\"type\":1,\"content\":{\"json\":\"### Note on malware scanning cost estimates:\\r\\n\\r\\n#### This tool estimates malware scanning costs based on the total volume of blobs uploaded, as indicated by Blob Ingress metrics. Please consider the following:\\r\\n\\r\\n- **Multiple scans:** Specific upload methods, such as `PutBlockList` operations, may trigger multiple scans for a single blob (e.g., when writing logs to the same blob). This tool does not accurately capture the additional costs from multiple scans triggered by such operations.\\r\\n\\r\\n- **Index Tag costs:** Costs associated with blob index tags, which store scan times and results on supported blobs, are not included in these estimates. Learn more on index tags costs in the [Azure Storage Blobs Pricing](https://azure.microsoft.com/en-us/pricing/details/storage/blobs/ \\\"https://azure.microsoft.com/en-us/pricing/details/storage/blobs/\\\") page.\\r\\n\\r\\n- **Blob size:** The estimation accounts for all uploaded blobs; however, only blobs smaller than 2GB are actually scanned.\",\"style\":\"warning\"},\"name\":\"text - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"da4af50d-362d-4790-887e-ff04153716f5\\\",\\\"mergeType\\\":\\\"table\\\",\\\"leftTable\\\":\\\"metric - 0\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[metric - 0].Subscription\\\",\\\"mergedName\\\":\\\"Subscription\\\",\\\"fromId\\\":\\\"da4af50d-362d-4790-887e-ff04153716f5\\\"},{\\\"originalName\\\":\\\"[metric - 0].Name\\\",\\\"mergedName\\\":\\\"Name\\\",\\\"fromId\\\":\\\"da4af50d-362d-4790-887e-ff04153716f5\\\"},{\\\"originalName\\\":\\\"[metric - 0].microsoft.storage/storageaccounts/blobservices-Transaction-Transactions\\\",\\\"mergedName\\\":\\\"BlolbsTransactionsOriginal\\\",\\\"fromId\\\":\\\"da4af50d-362d-4790-887e-ff04153716f5\\\"},{\\\"originalName\\\":\\\"[metric - 0].microsoft.storage/storageaccounts/fileservices-Transaction-Transactions\\\",\\\"mergedName\\\":\\\"FilesTransactionsOriginal\\\",\\\"fromId\\\":\\\"da4af50d-362d-4790-887e-ff04153716f5\\\"},{\\\"originalName\\\":\\\"[metric - 0].microsoft.storage/storageaccounts/blobservices-Transaction-Ingress\\\",\\\"mergedName\\\":\\\"IngressBytesOriginal\\\",\\\"fromId\\\":\\\"unknown\\\"},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"BlobTransactions\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"leftOperand\\\":\\\"BlolbsTransactionsOriginal\\\",\\\"operator\\\":\\\"isNotNull\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"column\\\",\\\"resultVal\\\":\\\"BlolbsTransactionsOriginal\\\"}},{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"static\\\",\\\"resultVal\\\":\\\"0\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"FileTransactions\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"leftOperand\\\":\\\"FilesTransactionsOriginal\\\",\\\"operator\\\":\\\"isNotNull\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"column\\\",\\\"resultVal\\\":\\\"FilesTransactionsOriginal\\\"}},{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"static\\\",\\\"resultVal\\\":\\\"0\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"TotalTransactions\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"[\\\\\\\"BlobTransactions\\\\\\\"]+[\\\\\\\"FileTransactions\\\\\\\"]\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"EstimatedMonthlyTransactions\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"(([\\\\\\\"TotalTransactions\\\\\\\"])/({TimeRange:seconds}/86400)*30)\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"OverageTransactions\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"leftOperand\\\":\\\"EstimatedMonthlyTransactions\\\",\\\"operator\\\":\\\">=\\\",\\\"rightValType\\\":\\\"static\\\",\\\"rightVal\\\":\\\"73000000\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"[\\\\\\\"EstimatedMonthlyTransactions\\\\\\\"] - 73000000\\\"}},{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"0\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"StorageAccountCost\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"10\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"OverageFee\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"([\\\\\\\"OverageTransactions\\\\\\\"]/1000000)*0.1492\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"EstimatedMonthlyCost\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"[\\\\\\\"StorageAccountCost\\\\\\\"] + [\\\\\\\"OverageFee\\\\\\\"]\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"Total Estimated Cost\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"static\\\",\\\"resultVal\\\":\\\"Total Estimated Cost\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"IngressBytes\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"leftOperand\\\":\\\"IngressBytesOriginal\\\",\\\"operator\\\":\\\"isNotNull\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"column\\\",\\\"resultVal\\\":\\\"IngressBytesOriginal\\\"}},{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"'0'\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"EstimatedMonthlyGigaBytes\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"((([\\\\\\\"IngressBytes\\\\\\\"])/({TimeRange:seconds}/86400)*30))/1073741824\\\"}}]},{\\\"originalName\\\":\\\"[Added column]\\\",\\\"mergedName\\\":\\\"Estimated malware scanning cost\\\",\\\"fromId\\\":null,\\\"isNewItem\\\":true,\\\"newItemData\\\":[{\\\"criteriaContext\\\":{\\\"operator\\\":\\\"Default\\\",\\\"rightValType\\\":\\\"column\\\",\\\"resultValType\\\":\\\"expression\\\",\\\"resultVal\\\":\\\"[\\\\\\\"EstimatedMonthlyGigaBytes\\\\\\\"]*0.15\\\"}}]},{\\\"originalName\\\":\\\"[metric - 0].microsoft.storage/storageaccounts/blobservices-Transaction-Transactions Timeline\\\"},{\\\"originalName\\\":\\\"[metric - 0].microsoft.storage/storageaccounts/fileservices-Transaction-Transactions Timeline\\\"},{\\\"originalName\\\":\\\"[metric - 0].microsoft.storage/storageaccounts/blobservices-Transaction-Ingress Timeline\\\"}]}\",\"size\":3,\"exportToExcelOptions\":\"all\",\"queryType\":7,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true,\"customColumnWidthSetting\":\"29ch\"}},{\"columnMatch\":\"Subscription\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"}},{\"columnMatch\":\"Name\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"}},{\"columnMatch\":\"BlolbsTransactionsOriginal\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\"}},{\"columnMatch\":\"FilesTransactionsOriginal\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\"}},{\"columnMatch\":\"IngressBytesOriginal\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"BlobTransactions\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"FileTransactions\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalTransactions\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\",\"customColumnWidthSetting\":\"20ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":0}}},{\"columnMatch\":\"EstimatedMonthlyTransactions\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"OverageTransactions\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"StorageAccountCost\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":17,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"OverageFee\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":17,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"EstimatedMonthlyCost\",\"formatter\":3,\"formatOptions\":{\"palette\":\"yellow\",\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":17,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Total Estimated Cost\",\"formatter\":5},{\"columnMatch\":\"IngressBytes\",\"formatter\":5,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"EstimatedMonthlyGigaBytes\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":5,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"Estimated malware scanning cost\",\"formatter\":3,\"formatOptions\":{\"palette\":\"yellowDark\",\"aggregation\":\"Sum\"},\"numberFormat\":{\"unit\":17,\"options\":{\"currency\":\"USD\",\"style\":\"currency\",\"useGrouping\":true,\"maximumFractionDigits\":2}}}],\"rowLimit\":10000,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Total Estimated Cost\",\"Subscription\"],\"expandTopLevel\":false},\"sortBy\":[{\"itemKey\":\"$gen_link_$gen_group_0\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"Subscription\",\"label\":\"Subscription\"},{\"columnId\":\"Name\",\"label\":\"Storage account\"},{\"columnId\":\"BlolbsTransactionsOriginal\",\"label\":\"Blob transactions (original)\"},{\"columnId\":\"FilesTransactionsOriginal\",\"label\":\"Files transactions (original)\"},{\"columnId\":\"IngressBytesOriginal\",\"label\":\"Ingress bytes (original)\"},{\"columnId\":\"BlobTransactions\",\"label\":\"Estimated monthly transactions\"},{\"columnId\":\"FileTransactions\",\"label\":\"Files transactions\"},{\"columnId\":\"TotalTransactions\",\"label\":\"Total transactions (7d)\"},{\"columnId\":\"EstimatedMonthlyTransactions\",\"label\":\"Estimated monthly transactions\"},{\"columnId\":\"OverageTransactions\",\"label\":\"Overage transactions\"},{\"columnId\":\"StorageAccountCost\",\"label\":\"Storage account cost\"},{\"columnId\":\"OverageFee\",\"label\":\"Estimated overage charge\"},{\"columnId\":\"EstimatedMonthlyCost\",\"label\":\"Estimated monthly cost (activity monitoring)\"},{\"columnId\":\"Total Estimated Cost\",\"label\":\"Estimated activity monitoring cost\"},{\"columnId\":\"IngressBytes\",\"label\":\"Ingress bytes\"},{\"columnId\":\"EstimatedMonthlyGigaBytes\",\"label\":\"Estimated monthly uploaded GBs\"},{\"columnId\":\"Estimated malware scanning cost\",\"label\":\"Estimated malware scanning cost\"}]},\"sortBy\":[{\"itemKey\":\"$gen_link_$gen_group_0\",\"sortOrder\":1}]},\"name\":\"query - 1\"}]},\"conditionalVisibility\":{\"parameterName\":\"SelectedView\",\"comparison\":\"isEqualTo\",\"value\":\"Storage\"},\"name\":\"DfStorage - PerStorage\"},{\"type\":1,\"content\":{\"json\":\"### For more information:\\r\\n- #### [Capabilities and benefits of Defender for Storage](https://learn.microsoft.com/azure/defender-for-cloud/defender-for-storage-introduction)\\r\\n- #### [Malware scanning in Defender for Storage](https://learn.microsoft.com/azure/defender-for-cloud/defender-for-storage-malware-scan)\\r\\n- #### [Sensitive data threat detection in Defender for Storage](https://learn.microsoft.com/azure/defender-for-cloud/defender-for-storage-data-sensitivity)\\r\\n- #### [List of security threats and security alerts](https://learn.microsoft.com/azure/defender-for-cloud/defender-for-storage-threats-alerts)\\r\\n- #### [Enable and configure Defender for Storage](https://learn.microsoft.com/azure/defender-for-cloud/tutorial-enable-storage-plan)\"},\"name\":\"text - 13\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"azure security center\"],\"fromTemplateId\":\"DefenderForCloudPriceEstimation\"}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}
