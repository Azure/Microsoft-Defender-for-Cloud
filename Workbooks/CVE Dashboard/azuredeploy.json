{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "CVE Dashboard for Servers",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "Azure Security Center",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Vulnerabilities by CVE IDs\\n\\nThis workbook shows vulnerabilities by CVE IDs found by agent-based [Microsoft Defender Vulnerability Management](https://docs.microsoft.com/en-us/azure/defender-for-cloud/deploy-vulnerability-assessment-tvm), [agentless scanning](https://learn.microsoft.com/en-gb/azure/defender-for-cloud/enable-agentless-scanning-vms) or by the [integrated Qualys VA solution](https://docs.microsoft.com/en-us/azure/defender-for-cloud/deploy-vulnerability-assessment-vm) on machines that are protected by Microsoft Defender for Servers.\\n\"},\"name\":\"intro\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"89bf65ba-5407-4b0a-b3d6-a973db229ecd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"subscriptions\",\"label\":\"Subscription(s)\",\"type\":6,\"description\":\"Select one or several subscription(s)\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":false,\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"9d81f11a-6c64-4748-b477-dfe5e417ec18\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"severity\",\"label\":\"Severity\",\"type\":2,\"description\":\"Select the CVE severity\",\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\n { \\\"value\\\": \\\"Critical\\\", \\\"label\\\": \\\"Critical\\\"},\\n { \\\"value\\\": \\\"High\\\", \\\"label\\\": \\\"High\\\"},\\n { \\\"value\\\": \\\"Medium\\\", \\\"label\\\": \\\"Medium\\\"},\\n { \\\"value\\\": \\\"Low\\\", \\\"label\\\": \\\"Low\\\"}\\n]\",\"defaultValue\":\"value::all\"},{\"id\":\"34ddfc0b-0174-4c66-98c5-ff2f8a5a6d1b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"vasolution\",\"label\":\"VA Solution\",\"type\":10,\"description\":\"Please select the VA solution you are using in your environment\",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\n { \\\"value\\\": \\\"Microsoft Defender vulnerability management\\\", \\\"label\\\": \\\"MDVM\\\"},\\n { \\\"value\\\": \\\"Built-in Qualys vulnerability assessment\\\", \\\"label\\\": \\\"Qualys\\\"}\\n]\",\"value\":\"Microsoft Defender vulnerability management\"},{\"id\":\"fb25118f-8331-4368-b6ab-a2393d748e08\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"info\",\"label\":\"Additional information\",\"type\":10,\"description\":\"Show additional information for this workbook\",\"isRequired\":true,\"value\":\"Off\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\n { \\\"value\\\": \\\"On\\\", \\\"label\\\": \\\"On\\\"},\\n { \\\"value\\\": \\\"Off\\\", \\\"label\\\": \\\"Off\\\"}\\n]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 0\"},{\"type\":1,\"content\":{\"json\":\"## Important\\n\\nDefender for Server's vulnerability assessment solution powered by Qualys is on a retirement path that completed on May 1st, 2024. If you are still using the built-in vulnerability assessment powered by Qualys, you should plan to transition to the Microsoft Defender Vulnerability Management vulnerability scanning solution. This solution was automatically enabled in your environment in case you have Defender for Endpoint (MDE) integration or agentless scanning enabled.\\n\\nCheck out [common questions](https://learn.microsoft.com/en-gb/azure/defender-for-cloud/faq-scanner-detection) regarding the transition to Microsoft Defender Vulnerability Management.\\n\\nCustomers who want to continue using Qualys, can do so with the [Bring Your Own License (BYOL) method](https://learn.microsoft.com/en-gb/azure/defender-for-cloud/deploy-vulnerability-assessment-byol-vm).\",\"style\":\"info\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"vasolution\",\"comparison\":\"isEqualTo\",\"value\":\"Built-in Qualys vulnerability assessment\"},\"name\":\"text - 9\"},{\"type\":1,\"content\":{\"json\":\"## Prerequisites\\nThe following prerequisites need to be in place before the workbook will show vulnerability findings:\\n1. Defender for Servers (Plan 1 or Plan 2) needs to be enabled on the selected subscription(s). For [agentless VA scanning](https://learn.microsoft.com/en-gb/azure/defender-for-cloud/enable-agentless-scanning-vms) you can alternatively use Defender CSPM.\\n2. Microsoft Defender Vulnerability Management (MDVM), agentless scanning, or the integrated Qualys VA solution need to be deployed to your Azure VMs and/or non-Azure machines that are connected via Azure Arc-enabled servers. You can use Defender for Cloud's [auto-provisioning capability](https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-data-collection?tabs=autoprovision-va#availability) to automatically deploy one of the solutions to your machines.\\n\\t- agent-based MDVM is available with both Defender for Servers plans, but depends on Microsoft Defender for Endpoint. In order to see vulnerability findings with MDVM, [MDE integration needs to be enabled](https://docs.microsoft.com/en-us/azure/defender-for-cloud/integration-defender-for-endpoint?tabs=windows) and MDE needs to be deployed to your machines.\\n\\t- Qualys VA solution requires Defender for Servers Plan 2 to be enabled on your subscription.\\n3. After one of the VA solutions has been deployed to your machines, it can take up to 12 hours before you see initial findings in the *Machines should have vulnerability findings resolved* recommendation. This recommendation is used in this workbook to show VA findings.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"prerequisites\"},{\"type\":1,\"content\":{\"json\":\"## How to use the parameters\\n\\n|Parameter|Description|\\n|---|---|---|\\n| Subscription(s) | Select one, several, or all subscriptions in your environment. The workbook will use this filter to display vulnerabilities according to the selected scope. |\\n| Severity | Vulnerabilities are measured in low, medium, and high severity. Select any combination of vulnerabilities you want to display in this workbook. |\\n| VA Solution | Microsoft Defender for Servers allows you to deploy and integrate Qualys, or Microsoft Defender Vulnerability Management (TVM). Both solutions provide different information, so please select the VA solution you have deployed in your environment. |\\n| Additional information | Shows this and additional information about this workbook. |\\n\\n## Release notes\\n\\n|Version|Description|Date|\\n|---|---|---|\\n|v0.9|initial release, public preview of Defender for Cloud  for Servers on Github at https://aka.ms/CVEDashboard|7/20/2022|\\n|v1.0|final release|8/15/2022|\\n|v1.1|adding support for EC2 agentless VA scanning in MDVM|2/3/2023|\\n|v1.2|adding table for total CVEs per machine|2/7/2023|\\n|v1.3|updating query to combine MDVM findings from agent-based and agentless scanning|9/6/2023|\\n|v1.4|Query update to show multicloud resource names when using agentless VA scanning|4/9/2024|\\n|v1.5|Adding Qualys deprecation note|5/6/2024|\\n|v1.6|Adding support for critical severity |6/10/2024|\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"releaseNotes\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"4907e207-c3c8-4d85-b60d-e0e926101c17\",\"cellValue\":\"tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Vulnerabilities by CVE ID\",\"subTarget\":\"CVEID\",\"style\":\"link\"},{\"id\":\"66b1d4be-4f02-4c29-9a80-b466901b787b\",\"cellValue\":\"tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Vulnerabilities by machine\",\"subTarget\":\"machine\",\"style\":\"link\"}]},\"name\":\"menu\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"In the *Vulnerabilities by CVE ID* section, the workbook shows all CVE IDs based on your subscription and severity selection on top of the workbook. The **Amount of CVE IDs by severity** pie chart shows the total number of unique CVE IDs to be addressed in your environment, grouped by severity, while the **List of CVE IDs** table shows details, including CVE IDs, CVSS, Severity, and other relevant information. When selecting one of the rows in this table, two additional tables will appear underneath: **Affected machines by CVE ID** which will show all machines that are affected by vulnerabilities which the CVE ID you selected belongs to, and **Affected software by CVE ID**, which shows the software this particular vulnerability applies to.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"CVEID-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project status = tostring(parse_json(properties).status.code), cve = parse_json(properties.additionalData).cve, Source = tostring(properties.additionalData.source), severityFilter = tostring(\\\"{severity}\\\")\\n| where status == 'Unhealthy'\\n| where Source in (\\\"Microsoft Defender vulnerability management\\\",\\\"Agentless Microsoft Defender vulnerability management\\\")\\n| mvexpand todynamic(cve)\\n| extend CVEID = tostring(cve['title']),\\n    severity = tostring(cve['severity'])\\n| where severityFilter has severity\\n| summarize CVEs = dcount(CVEID) by severity\\n\",\"size\":3,\"title\":\"Amount of CVE IDs by severity\",\"exportFieldName\":\"severity\",\"exportParameterName\":\"severity\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"severity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"dcount_CVEID\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"yAxis\":[\"CVEs\"],\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"}]}},\"customWidth\":\"25\",\"name\":\"CVEIDs-pie\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project Resource = tostring(properties.resourceDetails.id), ResourceGroup = trim_end(\\\"/\\\",extract(\\\".*resourceGroups/(.+?)/\\\",0,id)), ResourceType = tolower(split(id,\\\"/\\\").[6]), subscriptionId, status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), description = tostring(parse_json(properties).displayName), cve = parse_json(properties.additionalData).cve, SoftwareVendor = tostring(properties.additionalData.softwareVendor), SoftwareName = tostring(properties.additionalData.softwareName), SoftwareVersion = tostring(properties.additionalData.softwareVersion), Source = tostring(properties.additionalData.source),  severityFilter = tostring(\\\"{severity}\\\")\\n| where status == 'Unhealthy'\\n| where Source == \\\"Microsoft Defender vulnerability management\\\" or Source == \\\"Agentless Microsoft Defender vulnerability management\\\"\\n| mvexpand todynamic(cve)\\n| extend severity = tostring(cve['severity']),\\n    publishedDate = todatetime(cve['publishedDate']),\\n    lastModifiedDate = todatetime(cve['lastModifiedDate'])\\n| where severityFilter has severity\\n| summarize affectedMachines = dcount(Resource) by CVEID = tostring(cve['title']), cvssScore = todouble(cve['cvssScore']), severity, description = tostring(cve['description']), format_datetime(publishedDate, 'yyyy-MM-dd, hh:mm'), format_datetime(lastModifiedDate, 'yyyy-MM-dd, hh:mm'), hasPublicExploit = tostring(cve['hasPublicExploit']), isExploitVerified = tostring(cve['isExploitVerified']), exploitabilityLevel = tostring(cve['exploitabilityLevel'])\\n| order by cvssScore, affectedMachines\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"List of CVE IDs\",\"exportFieldName\":\"CVEID\",\"exportParameterName\":\"CVEID\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cvssScore\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"yellow\",\"text\":\"{0}{1}\"}]},\"tooltipFormat\":{}},{\"columnMatch\":\"hasPublicExploit\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"Yes\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"No\"}]}},{\"columnMatch\":\"isExploitVerified\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"Yes\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"No\"}]}},{\"columnMatch\":\"exploitabilityLevel\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsPublic\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsVerified\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsInKit\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"affectedMachines\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"redBright\"}},{\"columnMatch\":\"isZeroDay\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"Yes\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"No\"}]}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"CVEID\",\"label\":\"CVE ID\"},{\"columnId\":\"cvssScore\",\"label\":\"CVSS\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"description\",\"label\":\"CVE Description\"},{\"columnId\":\"publishedDate\",\"label\":\"CVE published on\"},{\"columnId\":\"lastModifiedDate\",\"label\":\"CVE last modified on\"},{\"columnId\":\"hasPublicExploit\",\"label\":\"Public exploit\"},{\"columnId\":\"isExploitVerified\",\"label\":\"Is exploit verified?\"},{\"columnId\":\"exploitabilityLevel\",\"label\":\"Exploitability level\"},{\"columnId\":\"affectedMachines\",\"label\":\"Amount of affected machines\"}]}},\"customWidth\":\"75\",\"name\":\"CVEIDs-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| extend AzureVM = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/providers/Microsoft.Security.*)\\\",1,id)), multiCloudVM = tostring(properties.resourceDetails.resourceName)\\n| project Resource = case(isnotempty(multiCloudVM),multiCloudVM,AzureVM), ResourceGroup = tolower(trim_end(\\\"/\\\",extract(\\\".*resourceGroups/(.+?)/\\\",0,id))), subscriptionId, ResourceType = tolower(split(id,\\\"/\\\").[6]), status = tostring(parse_json(properties).status.code), VulnId = tostring(parse_json(properties).id), description = tostring(parse_json(properties).displayName), cve = parse_json(properties.additionalData).cve, SoftwareVendor = tostring(properties.additionalData.softwareVendor), SoftwareName = tostring(properties.additionalData.softwareName), SoftwareVersion = tostring(properties.additionalData.softwareVersion), Source = tostring(properties.additionalData.source)\\n| where cve has tostring(parse_json('{CVEID}'))\\n| summarize affectedSoftware = make_list(SoftwareName) by Resource, ResourceGroup, subscriptionId\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Affected machines by CVE ID\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"ResourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"labelSettings\":[{\"columnId\":\"Resource\",\"label\":\"Machine\"},{\"columnId\":\"ResourceGroup\",\"label\":\"Resource Group\"},{\"columnId\":\"subscriptionId\",\"label\":\"Subscription ID\"},{\"columnId\":\"affectedSoftware\",\"label\":\"Affected software\"}]},\"sortBy\":[]},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"CVEID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"affectedmachines-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| extend AzureVM = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/providers/Microsoft.Security.*)\\\",1,id)), multiCloudVM = tostring(properties.resourceDetails.resourceName)\\n| project Resource = case(isnotempty(multiCloudVM),multiCloudVM,AzureVM), resourceGroup = tolower(trim_end(\\\"/\\\",extract(\\\".*resourceGroups/(.+?)/\\\",0,id))), subscriptionId, resourceType = tolower(split(id,\\\"/\\\").[6]), status = tostring(parse_json(properties).status.code), vulnId = tostring(parse_json(properties).id), description = tostring(parse_json(properties).displayName), cve = parse_json(properties.additionalData).cve, softwareVendor = tostring(properties.additionalData.softwareVendor), softwareName = tostring(properties.additionalData.softwareName), softwareVersion = tostring(properties.additionalData.softwareVersion), source = tostring(properties.additionalData.source)\\n| where cve has tostring(parse_json('{CVEID}'))\\n| summarize affectedMachines = make_list(Resource) by softwareName, softwareVendor, softwareVersion, description, vulnId\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Affected software by CVE ID\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"softwareName\",\"label\":\"Software name\"},{\"columnId\":\"softwareVendor\",\"label\":\"Sofware vendor\"},{\"columnId\":\"softwareVersion\",\"label\":\"Affected version\"},{\"columnId\":\"description\",\"label\":\"Description\"},{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"affectedMachines\",\"label\":\"List of affected machines\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"CVEID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"affectedsoftware-query\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"CVEID\"},{\"parameterName\":\"vasolution\",\"comparison\":\"isEqualTo\",\"value\":\"Microsoft Defender vulnerability management\"}],\"name\":\"CVEIDs-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"In the *Vulnerabilities by machine* section, the workbook shows machines in subscriptions which are affected by open vulnerabilities. The **Amount of vulnerabilities by machine** table shows affected machines and the amount of open vulnerabilities, grouped by subscriptions. When selecting one row from this table, the **Discovered vulnerabilities per selected resource** table appears. This table contains a list of all vulnerabilities, including Vulnerability ID and affected software, which have been found on the machine you selected.\\nWhen selecting one of the vulnerabilities, the **Total number of CVEs in selected vulnerability** pie chart, and the **CVEs per vulnerability ID** table appear. The pie chart shows the total number of CVE IDs in the vulnerability you selected, including severity. The table shows details to these CVEs based on the selected Vulnerability ID.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"machine-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project resourceId = parse_json(properties.resourceDetails.id), subscriptionId, status = tostring(parse_json(properties).status.code), cve = parse_json(properties.additionalData).cve, softwareName = tostring(parse_json(properties.additionalData.softwareName)), source = tostring(properties.additionalData.source), vulnId = tostring(properties.id), severityFilter = tostring(\\\"{severity}\\\")\\n| where status == 'Unhealthy'\\n| where source in (\\\"Microsoft Defender vulnerability management\\\",\\\"Agentless Microsoft Defender vulnerability management\\\")\\n| mvexpand todynamic(cve)\\n| extend CVEID = tostring(cve['title']),\\n    severity = tostring(cve['severity'])\\n| where severityFilter has severity\\n| summarize vulnerabilities = dcount(vulnId) by tostring(resourceId), subscriptionId | order by vulnerabilities\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Amount of vulnerabilities by machine\",\"exportFieldName\":\"resourceId\",\"exportParameterName\":\"resourceId\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"labelSettings\":[{\"columnId\":\"subscriptionId\",\"label\":\"Subscription ID\"},{\"columnId\":\"vulnerabilities\",\"label\":\"Amount of open vulnerabilities\"}]}},\"customWidth\":\"50\",\"name\":\"vulnerabilities-machines-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project resourceId = parse_json(properties.resourceDetails.id), vulnId = tostring(properties.id), softwareName = tostring(parse_json(properties.additionalData.softwareName))\\n| where resourceId == \\\"{resourceId}\\\"\",\"size\":0,\"showAnalytics\":true,\"title\":\"Discovered vulnerabilities per selected resource\",\"exportFieldName\":\"vulnId\",\"exportParameterName\":\"vulnId\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"resourceId\",\"formatter\":5}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"softwareName\",\"label\":\"Affected software\"}]}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"resourceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"vulnerabilitiesPerResource-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project resourceId = parse_json(properties.resourceDetails.id), vulnId = tostring(parse_json(properties).id), cve = parse_json(properties.additionalData).cve\\n| mvexpand todynamic(cve)\\n| extend CVEID = tostring(cve['title']),\\n    severity = tostring(cve['severity'])\\n| where resourceId == \\\"{resourceId}\\\"\\n| where vulnId == \\\"{vulnId}\\\"\\n| summarize count() by severity\",\"size\":3,\"title\":\"Total number of CVEs in selected vulnerability\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"severity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"coldHot\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vulnId\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"red\"}]},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"vulnId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"totalCvesPerVulnerability-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project resourceId = parse_json(properties.resourceDetails.id), vulnId = tostring(parse_json(properties).id), cve = parse_json(properties.additionalData).cve\\n| mvexpand todynamic(cve)\\n| extend publishedDate = todatetime(cve['publishedDate']),\\n    lastModifiedDate = todatetime(cve['lastModifiedDate'])\\n| where vulnId == \\\"{vulnId}\\\" and resourceId == \\\"{resourceId}\\\"\\n| project vulnId, CVEID = tostring(cve['title']), cvssScore = todouble(cve['cvssScore']), severity = tostring(cve['severity']), description = tostring(cve['description']), format_datetime(publishedDate, 'yyyy-MM-dd, hh:mm'), format_datetime(lastModifiedDate, 'yyyy-MM-dd, hh:mm'), isExploitVerified = tostring(cve['isExploitVerified']), hasPublicExploit = tostring(cve['hasPublicExploit']), exploitabilityLevel = tostring(cve['exploitabilityLevel'])\\n| order by cvssScore\\n\\n//| project resourceId = parse_json(properties.resourceDetails.id), vulnId = tostring(properties.id), softwareName = tostring(parse_json(properties.additionalData.softwareName))\\n//| where vulnId == \\\"{vulnId}\\\"\",\"size\":3,\"showAnalytics\":true,\"title\":\"CVEs per vulnerability ID\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cvssScore\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"yellow\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"isExploitVerified\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"hasPublicExploit\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"exploitabilityLevel\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsVerified\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsPublic\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsInKit\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"isZeroDay\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"Normal\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"3\",\"text\":\"Yes\"}]}}],\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_heatmap_cvssScore_2\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"CVEID\",\"label\":\"CVE ID\"},{\"columnId\":\"cvssScore\",\"label\":\"CVSS\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"description\",\"label\":\"CVE description\"},{\"columnId\":\"publishedDate\",\"label\":\"CVE published on\"},{\"columnId\":\"lastModifiedDate\",\"label\":\"CVE last modified on\"},{\"columnId\":\"isExploitVerified\",\"label\":\"Is exploit verified?\"},{\"columnId\":\"hasPublicExploit\",\"label\":\"Does a public exploit exist?\"},{\"columnId\":\"exploitabilityLevel\",\"label\":\"Exploitability level\"}]},\"sortBy\":[{\"itemKey\":\"$gen_heatmap_cvssScore_2\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"vulnId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"CvesPerVulnerability-details-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey in (\\\"1195afff-c881-495e-9bc5-1486211ae03f\\\",\\\"77a4a140-e051-481a-84cc-d4bf2109bd65\\\")\\n| project resourceId = parse_json(properties.resourceDetails.id), vulnId = tostring(parse_json(properties).id), cve = parse_json(properties.additionalData).cve\\n| mvexpand todynamic(cve)\\n| extend publishedDate = todatetime(cve['publishedDate']),\\n    lastModifiedDate = todatetime(cve['lastModifiedDate'])\\n| where resourceId == \\\"{resourceId}\\\"\\n| project vulnId, CVEID = tostring(cve['title']), cvssScore = todouble(cve['cvssScore']), severity = tostring(cve['severity']), description = tostring(cve['description']), format_datetime(publishedDate, 'yyyy-MM-dd, hh:mm'), format_datetime(lastModifiedDate, 'yyyy-MM-dd, hh:mm'), isExploitVerified = tostring(cve['isExploitVerified']), hasPublicExploit = tostring(cve['hasPublicExploit']), exploitabilityLevel = tostring(cve['exploitabilityLevel'])\\n| distinct CVEID, cvssScore, severity, description, publishedDate, lastModifiedDate, isExploitVerified, hasPublicExploit, exploitabilityLevel\\n| order by cvssScore\",\"size\":3,\"showAnalytics\":true,\"title\":\"Total CVEs per machine\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cvssScore\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"yellow\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"isExploitVerified\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"hasPublicExploit\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"exploitabilityLevel\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsVerified\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsPublic\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"ExploitIsInKit\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"isZeroDay\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"Normal\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"3\",\"text\":\"Yes\"}]}}],\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_heatmap_cvssScore_1\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"$gen_heatmap_cvssScore_1\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"resourceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"CvesPerVulnerabilityTotal-details-query\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"machine\"},{\"parameterName\":\"vasolution\",\"comparison\":\"isEqualTo\",\"value\":\"Microsoft Defender vulnerability management\"}],\"name\":\"machine-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"In the *Vulnerabilities by CVE ID* section, the workbook shows all CVE IDs based on your subscription and severity selection on top of the workbook. The **Amount of CVE IDs by severity** pie chart shows the total number of unique CVE IDs to be addressed in your environment, grouped by severity, while the **List of CVE IDs** table shows details, including CVE IDs, CVSS, Severity, and other relevant information. When selecting one of the rows in this table, two additional tables will appear underneath: **Affected machines by CVE ID** which will show all machines that are affected by vulnerabilities which the CVE ID you selected belongs to, and **Vulnerability details**, which shows more details about this vulnerability.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"CVEID-Qualys-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| extend source = tostring(properties.additionalData.source)\\n| where source == \\\"Built-in Qualys vulnerability assessment\\\"\\n| project cve = parse_json(properties.additionalData).cve,\\n    severity = tostring(properties.status.severity),\\n    severityFilter = tostring(\\\"{severity}\\\"),\\n    status = tostring(parse_json(properties).status.code)\\n| mvexpand todynamic(cve)\\n| where severityFilter has severity and status == \\\"Unhealthy\\\"\\n| summarize CVEs = dcount(CVEID = tostring(cve['title'])) by severity\\n\",\"size\":3,\"title\":\"Amount of CVE IDs by severity\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"}]}},\"customWidth\":\"25\",\"name\":\"CVEIDs-Qualys-pie\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| extend source = tostring(properties.additionalData.source)\\n| where source == \\\"Built-in Qualys vulnerability assessment\\\"\\n| project resource = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/providers/Microsoft.Security.*)\\\",1,id)),\\n    description = tostring(properties.description),\\n    publishedTime = todatetime(properties.additionalData.publishedTime),\\n    patchable = tostring(properties.additionalData.patchable),\\n    cve = parse_json(properties.additionalData).cve,\\n    cvss2 = tostring(properties.additionalData.cvss.['2.0'].base),\\n    cvss3 = tostring(properties.additionalData.cvss.['3.0'].base),\\n    severity = tostring(properties.status.severity),\\n    impact = tostring(properties.impact),\\n    severityFilter = tostring(\\\"{severity}\\\"),\\n    vulnId = tostring(properties.id),\\n    status = tostring(parse_json(properties).status.code)\\n| mvexpand todynamic(cve)\\n| where severityFilter has severity and status == \\\"Unhealthy\\\"\\n| summarize affectedMachines = dcount(resource) by CVEID = tostring(cve['title']), cvss2, cvss3, severity, description, format_datetime(publishedTime, 'yyyy-MM-dd, hh:mm'), patchable, impact, vulnId\\n| order by cvss2, cvss3, affectedMachines\",\"size\":0,\"showAnalytics\":true,\"title\":\"List of CVE IDs\",\"exportFieldName\":\"CVEID\",\"exportParameterName\":\"CVEID\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cvss2\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"}},{\"columnMatch\":\"cvss3\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"patchable\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"2\",\"text\":\"No\"},{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"Available\",\"text\":\"Yes\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"unknown\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"affectedMachines\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"palette\":\"red\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"CVEID\",\"label\":\"CVE ID\"},{\"columnId\":\"cvss2\",\"label\":\"CVSS 2.0\"},{\"columnId\":\"cvss3\",\"label\":\"CVSS 3.0\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"description\",\"label\":\"Description\"},{\"columnId\":\"publishedTime\",\"label\":\"CVE published on\"},{\"columnId\":\"patchable\",\"label\":\"Patchable\"},{\"columnId\":\"impact\",\"label\":\"Impact\"},{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"affectedMachines\",\"label\":\"Amount of affected machines\"}]}},\"customWidth\":\"75\",\"name\":\"CVEIDs-Qualys-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| project resource = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/providers/Microsoft.Security.*)\\\",1,id)), resourceGroup = tolower(trim_end(\\\"/\\\",extract(\\\".*resourceGroups/(.+?)/\\\",0,id))), subscriptionId, cve = parse_json(properties.additionalData).cve\\n| where cve has tostring(parse_json('{CVEID}'))\\n| summarize by resource, resourceGroup, subscriptionId\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Affected machines by CVE ID\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"labelSettings\":[{\"columnId\":\"resource\",\"label\":\"Machine\"},{\"columnId\":\"resourceGroup\",\"label\":\"Resource Group\"},{\"columnId\":\"subscriptionId\",\"label\":\"Subscription ID\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"CVEID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"affectedmachines-qualys-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| extend resource = tolower(extract(\\\"([\\\\\\\\s\\\\\\\\S]*?)(/providers/Microsoft.Security.*)\\\",1,id)), vulnId = tostring(parse_json(properties).id), description = tostring(parse_json(properties).displayName), cve = parse_json(properties.additionalData).cve, softwareVendor = tostring(properties.additionalData.softwareVendor), threat = tostring(properties.additionalData.threat)\\n| where cve has tostring(parse_json('{CVEID}'))\\n| summarize affectedMachines = make_list(resource) by description, threat, vulnId\\n\",\"size\":3,\"showAnalytics\":true,\"title\":\"Vulnerability details\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"filter\":true,\"labelSettings\":[{\"columnId\":\"description\",\"label\":\"Description\"},{\"columnId\":\"threat\",\"label\":\"Threat\"},{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"affectedMachines\",\"label\":\"List of affected machines\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"CVEID\",\"comparison\":\"isNotEqualTo\"},\"name\":\"vulnerabilityDetails-Qualys-query\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"CVEID\"},{\"parameterName\":\"vasolution\",\"comparison\":\"isEqualTo\",\"value\":\"Built-in Qualys vulnerability assessment\"}],\"name\":\"CVEID-Qualys-group\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"In the *Vulnerabilities by machine* section, the workbook shows machines in subscriptions which are affected by open vulnerabilities. The **Amount of vulnerabilities by machine** table shows affected machines and the amount of open vulnerabilities, grouped by subscriptions. When selecting one row from this table, the **Discovered vulnerabilities per selected resource** table appears. This table contains a list of all vulnerabilities, including Vulnerability ID and affected software, which have been found on the machine you selected.\\nWhen selecting one of the vulnerabilities, the **Total number of CVEs in selected vulnerability** pie chart, and the **CVEs per vulnerability ID** table appear. The pie chart shows the total number of CVE IDs in the vulnerability you selected, including severity. The table shows details to these CVEs based on the selected Vulnerability ID.\"},\"conditionalVisibility\":{\"parameterName\":\"info\",\"comparison\":\"isEqualTo\",\"value\":\"On\"},\"name\":\"machine-Qualys-info\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| project resourceId = parse_json(properties.resourceDetails.id), subscriptionId, status = tostring(parse_json(properties).status.code), source = tostring(properties.additionalData.source), vulnId = tostring(properties.id)\\n| where status == 'Unhealthy' and source == \\\"Built-in Qualys vulnerability assessment\\\"\\n| summarize vulnerabilities = dcount(vulnId) by tostring(resourceId), subscriptionId | order by vulnerabilities\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Amount of vulnerabilities by machine\",\"exportFieldName\":\"resourceId\",\"exportParameterName\":\"resourceId\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}}],\"rowLimit\":10000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true},\"labelSettings\":[{\"columnId\":\"resourceId\",\"label\":\"Affected resource\"},{\"columnId\":\"subscriptionId\",\"label\":\"Subscription ID\"},{\"columnId\":\"vulnerabilities\",\"label\":\"Amount of open vulnerabilities\"}]}},\"customWidth\":\"50\",\"name\":\"vulnerabilities-machines-Qualys-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| project resourceId = parse_json(properties.resourceDetails.id), source = tostring(properties.additionalData.source), vulnId = tostring(properties.id), softwareName = tostring(properties.displayName), status = tostring(properties.status.code)\\n| where resourceId == \\\"{resourceId}\\\" and status == \\\"Unhealthy\\\" and source == \\\"Built-in Qualys vulnerability assessment\\\"\",\"size\":0,\"showAnalytics\":true,\"title\":\"Discovered vulnerabilities per selected resource\",\"exportFieldName\":\"vulnId\",\"exportParameterName\":\"vulnId\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"resourceId\",\"formatter\":5},{\"columnMatch\":\"source\",\"formatter\":5},{\"columnMatch\":\"status\",\"formatter\":5}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"softwareName\",\"label\":\"Affected software\"}]}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"resourceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"vulnerabilitiesPerResource-Qualys-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\"\\n| project resourceId = parse_json(properties.resourceDetails.id), vulnId = tostring(parse_json(properties).id), cve = parse_json(properties.additionalData).cve, severity = tostring(properties.status.severity)\\n| mvexpand todynamic(cve)\\n| extend CVEID = tostring(cve['title'])\\n| where resourceId == \\\"{resourceId}\\\"\\n| where vulnId == \\\"{vulnId}\\\"\\n| summarize count() by severity\",\"size\":3,\"title\":\"Total number of CVEs in selected vulnerability\",\"noDataMessage\":\"There is no CVE information associated with this vulnerability ID.\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"Medium\",\"color\":\"orange\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Low\",\"color\":\"yellow\"}]}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"vulnId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"totalCvesPerVulnerability-Qualys-pie\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\" and properties.additionalData.source == \\\"Built-in Qualys vulnerability assessment\\\"\\n| project resourceId = parse_json(properties.resourceDetails.id),\\n    vulnId = tostring(parse_json(properties).id),\\n    cve = parse_json(properties.additionalData).cve,\\n    publishedTime = todatetime(properties.additionalData.publishedTime),\\n    severity = tostring(properties.status.severity),\\n    cvss2 = tostring(properties.additionalData.cvss.[\\\"2.0\\\"].base),\\n    cvss3 = tostring(properties.additionalData.cvss.[\\\"3.0\\\"].base),\\n    description = tostring(properties.description),\\n    impact = tostring(properties.impact)\\n| mvexpand todynamic(cve)\\n| where vulnId == \\\"{vulnId}\\\" and resourceId == \\\"{resourceId}\\\"\\n| project vulnId, CVEID = tostring(cve['title']), cvss2, cvss3, severity, description, impact, format_datetime(publishedTime, 'yyyy-MM-dd, hh:mm')\\n| order by cvss2\",\"size\":3,\"showAnalytics\":true,\"title\":\"CVEs per vulnerability ID\",\"noDataMessage\":\"There is no CVE information associated with this vulnerability ID.\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cvss2\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"cvss3\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"text\":\"{0}{1}\"}]}}],\"rowLimit\":1000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"CVEID\",\"label\":\"CVE ID\"},{\"columnId\":\"cvss2\",\"label\":\"CVSS 2.0\"},{\"columnId\":\"cvss3\",\"label\":\"CVSS 3.0\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"description\",\"label\":\"Description\"},{\"columnId\":\"impact\",\"label\":\"Impact\"},{\"columnId\":\"publishedTime\",\"label\":\"CVE published on\"}]}},\"conditionalVisibility\":{\"parameterName\":\"vulnId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"CvesPerVulnerability-details-Qualys-query\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\n| where type == \\\"microsoft.security/assessments/subassessments\\\"\\n| extend assessmentKey = extract(\\\".*assessments/(.+?)/.*\\\",1, id)\\n| where assessmentKey == \\\"1195afff-c881-495e-9bc5-1486211ae03f\\\" and properties.additionalData.source == \\\"Built-in Qualys vulnerability assessment\\\"\\n| project resourceId = parse_json(properties.resourceDetails.id),\\n    vulnId = tostring(parse_json(properties).id),\\n    cve = parse_json(properties.additionalData).cve,\\n    publishedTime = todatetime(properties.additionalData.publishedTime),\\n    severity = tostring(properties.status.severity),\\n    cvss2 = tostring(properties.additionalData.cvss.[\\\"2.0\\\"].base),\\n    cvss3 = tostring(properties.additionalData.cvss.[\\\"3.0\\\"].base),\\n    description = tostring(properties.description),\\n    impact = tostring(properties.impact)\\n| mvexpand todynamic(cve)\\n| where resourceId == \\\"{resourceId}\\\"\\n| project vulnId, CVEID = tostring(cve['title']), cvss2, cvss3, severity, description, impact, format_datetime(publishedTime, 'yyyy-MM-dd, hh:mm')\\n| order by cvss3\",\"size\":3,\"showAnalytics\":true,\"title\":\"Total CVEs per machine\",\"noDataMessage\":\"There is no CVE information associated with this vulnerability ID.\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"cvss2\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"cvss3\",\"formatter\":8,\"formatOptions\":{\"min\":1,\"max\":10,\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"text\":\"{0}{1}\"}]}}],\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_heatmap_cvss3_3\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"vulnId\",\"label\":\"Vulnerability ID\"},{\"columnId\":\"CVEID\",\"label\":\"CVE ID\"},{\"columnId\":\"cvss2\",\"label\":\"CVSS 2.0\"},{\"columnId\":\"cvss3\",\"label\":\"CVSS 3.0\"},{\"columnId\":\"severity\",\"label\":\"Severity\"},{\"columnId\":\"description\",\"label\":\"Description\"},{\"columnId\":\"impact\",\"label\":\"Impact\"},{\"columnId\":\"publishedTime\",\"label\":\"CVE published on\"}]},\"sortBy\":[{\"itemKey\":\"$gen_heatmap_cvss3_3\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"resourceId\",\"comparison\":\"isNotEqualTo\"},\"name\":\"CvesPerResourceTotal-details-Qualys-query\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"tab\",\"comparison\":\"isEqualTo\",\"value\":\"machine\"},{\"parameterName\":\"vasolution\",\"comparison\":\"isEqualTo\",\"value\":\"Built-in Qualys vulnerability assessment\"}],\"name\":\"machine-Qualys-group\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"Azure Security Center\"],\"fromTemplateId\":\"asc-cve-dashboard\"}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
}