{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Governance (Preview)",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "Azure Security Center",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "## Governance (Preview)"
          },
          "name": "Title"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "ca214f0d-aa7a-464a-b693-c22db46ae52f",
                "version": "KqlParameterItem/1.0",
                "name": "Subscription",
                "type": 6,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "includeAll": true,
                  "showDefault": false
                },
                "timeContext": {
                  "durationMs": 86400000
                },
                "defaultValue": "value::all",
                "value": [
                  "/subscriptions/212f9889-769e-45ae-ab43-6da33674bd26"
                ]
              }
            ],
            "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "Tabs"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "Select one or more governance rules from the list to see a list of affected recommendations",
                  "style": "info"
                },
                "name": "RulesGridExplination"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources         \r\n| where type == \"microsoft.security/assessments\"\r\n| where isnull(properties.resourceDetails.AwsResourceId) and isnull(properties.resourceDetails.GcpResourceId)\r\n| extend DisplayName = tostring(properties.displayName)\r\n| where isempty(DisplayName) == false\r\n| join kind=leftouter   (securityresources         \r\n| where type == \"microsoft.security/assessments/governanceassignments\"\r\n| extend  assignedResourceId = tostring(todynamic(properties).assignedResourceId)\r\n| extend remediationDueDate = todatetime(properties.remediationDueDate)\r\n| project id = assignedResourceId, governanceassignmentsProperties = todynamic(properties), remediationDueDate) on id\r\n| extend hasAssignment = isempty( governanceassignmentsProperties) == false and isnull( governanceassignmentsProperties) == false\r\n| extend assignmentStatus = iif(tostring(properties.status.code) == \"Unhealthy\",iif(hasAssignment == true, iif(bin(remediationDueDate, 1d) < bin(now(), 1d), \"Overdue\", \"Ontime\"), \"Unassigned\") , \"Completed\")\r\n| summarize count() by assignmentStatus\r\n",
                  "size": 3,
                  "title": "Resource status",
                  "noDataMessage": "No unhealthy resources found",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "visualization": "piechart",
                  "tileSettings": {
                    "titleContent": {
                      "columnMatch": "OsType",
                      "formatter": 1
                    },
                    "leftContent": {
                      "columnMatch": "count_",
                      "formatter": 12,
                      "formatOptions": {
                        "palette": "auto"
                      },
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "style": "decimal",
                          "useGrouping": false,
                          "maximumFractionDigits": 2,
                          "maximumSignificantDigits": 3
                        }
                      }
                    },
                    "showBorder": true
                  },
                  "graphSettings": {
                    "type": 0,
                    "topContent": {
                      "columnMatch": "OsType",
                      "formatter": 1
                    },
                    "centerContent": {
                      "columnMatch": "count_",
                      "formatter": 1,
                      "numberFormat": {
                        "unit": 17,
                        "options": {
                          "maximumSignificantDigits": 3,
                          "maximumFractionDigits": 2
                        }
                      }
                    }
                  },
                  "chartSettings": {
                    "seriesLabelSettings": [
                      {
                        "seriesName": "Ontime",
                        "color": "blue"
                      },
                      {
                        "seriesName": "Completed",
                        "color": "green"
                      },
                      {
                        "seriesName": "Unassigned",
                        "color": "orange"
                      },
                      {
                        "seriesName": "Overdue",
                        "color": "redBright"
                      }
                    ]
                  }
                },
                "customWidth": "20",
                "name": "statusePerAssessment"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources\r\n| where type == \"microsoft.security/governancerules\"\r\n| where tostring(properties.isDisabled) == \"false\"\r\n| extend ruleName = todynamic(name)\r\n| extend ownerType = iif(tostring(properties.ownerSource.type) == \"Manually\", \"Email\", \"ByTag\")\r\n| extend description = tostring(properties.description)\r\n| extend displayName = tostring(properties.displayName)\r\n| extend governanceEmailNotification = todynamic(properties.governanceEmailNotification)\r\n| extend isGracePeriod = todynamic(properties.isGracePeriod)\r\n| extend remediationTimeframe = todynamic(properties.remediationTimeframe)\r\n| extend sourceResourceType = todynamic(properties.sourceResourceType)\r\n| extend conditionSets = todynamic(properties.conditionSets)\r\n| extend rulePriority = todynamic(properties.rulePriority)\r\n| extend ownerSource = todynamic(properties.ownerSource)\r\n| extend isDisabled = todynamic(properties.isDisabled)\r\n| extend ruleType = todynamic(properties.ruleType)\r\n| extend  RuleConditionSet = tostring(properties.conditionSets), property =  properties.conditionSets[0].conditions[0].property, operator = properties.conditionSets[0].conditions[0].operator\r\n| project Subscription = subscriptionId, [\"Display name\"] = tostring(properties.displayName), Priority = toint(properties.rulePriority), [\"Remediation timeframe\"] = tostring(properties.remediationTimeframe), [\"owner type\"] = ownerType, [\"Owner details\"] = tostring(properties.ownerSource.value), [\"Grace period enabled\"] = tostring(properties.isGracePeriod), Rule = id, properties\r\n| order by Priority asc",
                  "size": 0,
                  "title": "Governance Rules",
                  "noDataMessage": "No Rules found",
                  "exportMultipleValues": true,
                  "exportedParameters": [
                    {
                      "fieldName": "Rule",
                      "parameterName": "Rule",
                      "parameterType": 1,
                      "quote": ""
                    }
                  ],
                  "showExportToExcel": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Subscription",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Display name",
                        "formatter": 1,
                        "formatOptions": {
                          "bladeOpenContext": {
                            "bladeName": "CreateGovernanceRuleContextBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "",
                                "source": "column",
                                "value": "properties"
                              },
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              },
                              {
                                "name": "governanceRuleToEdit",
                                "source": "column",
                                "value": "properties"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "Priority",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "Remediation timeframe",
                        "formatter": 0,
                        "tooltipFormat": {
                          "tooltip": "DD.HH.MM.SS"
                        }
                      },
                      {
                        "columnMatch": "Grace period enabled",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "true",
                              "representation": "success",
                              "text": ""
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "false",
                              "representation": "4",
                              "text": ""
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "Rule",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "subscriptionId",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "name",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "DisplayName",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "ownerDetails",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "isGracePeriod",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "remediationTimeframe",
                        "formatter": 1
                      }
                    ],
                    "rowLimit": 1000,
                    "filter": true,
                    "sortBy": [
                      {
                        "itemKey": "Display name",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "Display name",
                      "sortOrder": 1
                    }
                  ]
                },
                "customWidth": "80",
                "conditionalVisibility": {
                  "parameterName": "Subscription",
                  "comparison": "isNotEqualTo"
                },
                "name": "Rules",
                "styleSettings": {
                  "maxWidth": "100"
                }
              }
            ],
            "exportParameters": true
          },
          "customWidth": "100",
          "name": "subscriptionOverView"
        },
        {
          "type": 1,
          "content": {
            "json": "---"
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "resourceView"
          },
          "name": "LineSeparator1"
        },
        {
          "type": 1,
          "content": {
            "json": "ðŸ’¡ Selected filter for **RuleConditionSet:** {RuleConditionSet}\r\nðŸ’¡ Selected filter for **Rule:** {Rule}\r\nðŸ’¡ Selected filter for **Owner:** {Owner}\r\n",
            "style": "{selectedTab}"
          },
          "conditionalVisibility": {
            "parameterName": "parameter1",
            "comparison": "isEqualTo",
            "value": "1"
          },
          "name": "ResourceFilter"
        },
        {
          "type": 1,
          "content": {
            "json": " \r\n---"
          },
          "conditionalVisibility": {
            "parameterName": "selectedTab",
            "comparison": "isEqualTo",
            "value": "resourceView"
          },
          "name": "LineSeparator2"
        },
        {
          "type": 1,
          "content": {
            "json": "Select an assessment the list to see a list of affected resources",
            "style": "info"
          },
          "conditionalVisibilities": [
            {
              "parameterName": "Rule",
              "comparison": "isNotEqualTo"
            },
            {
              "parameterName": "DisplayName",
              "comparison": "isEqualTo"
            }
          ],
          "name": "assessmentsExplaination"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "securityresources         \r\n| where type == \"microsoft.security/assessments\"\r\n| where isnull(properties.resourceDetails.AwsResourceId) and isnull(properties.resourceDetails.GcpResourceId)\r\n| extend RuleId = split('{Rule}', \",\")\r\n| mv-expand RuleId\r\n| extend RuleId = tostring(RuleId)\r\n| extend DisplayName = tostring(properties.displayName)\r\n| where isempty(DisplayName) == false\r\n| join kind=leftouter   (securityresources         \r\n| where type == \"microsoft.security/governancerules\"\r\n| project RuleId = id, conditionSets = properties.conditionSets) on RuleId\r\n| mv-expand  conditions = conditionSets[0].conditions\r\n| where (conditions.property == \"name\" and strcat_array(conditions.value, \",\") contains name) or (conditions.property == \"properties.metadata.severity\" and strcat_array(conditions.value, \",\") contains properties.metadata.severity)\r\n| summarize arg_max(DisplayName, properties) by id\r\n| join kind=leftouter   (securityresources         \r\n| where type == \"microsoft.security/assessments/governanceassignments\"\r\n| extend  assignedResourceId = tostring(todynamic(properties).assignedResourceId)\r\n| extend remediationDueDate = todatetime(properties.remediationDueDate)\r\n| project id = assignedResourceId, governanceassignmentsProperties = todynamic(properties), remediationDueDate) on id\r\n| extend hasAssignment = isempty( governanceassignmentsProperties) == false and isnull( governanceassignmentsProperties) == false\r\n| extend assignmentStatus = iif(tostring(properties.status.code) == \"Unhealthy\",iif(hasAssignment == true, iif(bin(remediationDueDate, 1d) < bin(now(), 1d), \"Overdue\", \"Ontime\"), \"Unassigned\") , \"Completed\")\r\n| summarize count() by assignmentStatus",
            "size": 3,
            "title": "Status per rule",
            "noDataMessage": "No unhealthy resources found",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "visualization": "piechart",
            "gridSettings": {
              "rowLimit": 10000
            },
            "tileSettings": {
              "titleContent": {
                "columnMatch": "OsType",
                "formatter": 1
              },
              "leftContent": {
                "columnMatch": "count_",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto"
                },
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "style": "decimal",
                    "useGrouping": false,
                    "maximumFractionDigits": 2,
                    "maximumSignificantDigits": 3
                  }
                }
              },
              "showBorder": true
            },
            "graphSettings": {
              "type": 0,
              "topContent": {
                "columnMatch": "OsType",
                "formatter": 1
              },
              "centerContent": {
                "columnMatch": "count_",
                "formatter": 1,
                "numberFormat": {
                  "unit": 17,
                  "options": {
                    "maximumSignificantDigits": 3,
                    "maximumFractionDigits": 2
                  }
                }
              }
            },
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Ontime",
                  "color": "blue"
                },
                {
                  "seriesName": "Completed",
                  "color": "green"
                },
                {
                  "seriesName": "Unassigned",
                  "color": "orange"
                },
                {
                  "seriesName": "Overdue",
                  "color": "redBright"
                }
              ]
            }
          },
          "customWidth": "20",
          "conditionalVisibility": {
            "parameterName": "Rule",
            "comparison": "isNotEqualTo"
          },
          "name": "statusPerRule"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "securityresources         \r\n| where type == \"microsoft.security/assessments\"\r\n| where isnull(properties.resourceDetails.AwsResourceId) and isnull(properties.resourceDetails.GcpResourceId)\r\n| extend RuleId = split('{Rule}', \",\")\r\n| mv-expand RuleId\r\n| extend RuleId = tostring(RuleId)\r\n| extend DisplayName = tostring(properties.displayName)\r\n| where isempty(DisplayName) == false\r\n| join kind=leftouter   (securityresources         \r\n| where type == \"microsoft.security/governancerules\"\r\n| project RuleId = id, conditionSets = properties.conditionSets) on RuleId\r\n| mv-expand  conditions = conditionSets[0].conditions\r\n| where (conditions.property == \"name\" and strcat_array(conditions.value, \",\") contains name) or (conditions.property == \"properties.metadata.severity\" and strcat_array(conditions.value, \",\") contains properties.metadata.severity)\r\n| summarize arg_max(DisplayName, properties) by id\r\n| join kind=leftouter   (securityresources         \r\n| where type == \"microsoft.security/assessments/governanceassignments\"\r\n| extend  assignedResourceId = tostring(todynamic(properties).assignedResourceId)\r\n| extend remediationDueDate = todatetime(properties.remediationDueDate)\r\n| project id = assignedResourceId, governanceassignmentsProperties = todynamic(properties), remediationDueDate) on id\r\n| extend hasAssignment = isempty( governanceassignmentsProperties) == false and isnull( governanceassignmentsProperties) == false\r\n| extend assignmentStatus = iif(tostring(properties.status.code) == \"Unhealthy\",iif(hasAssignment == true, iif(bin(remediationDueDate, 1d) < bin(now(), 1d), \"Overdue\", \"Ontime\"), \"Unassigned\") , \"Completed\")\r\n| extend Status = assignmentStatus\r\n| summarize Completed = countif(Status == \"Completed\"), Ontime = countif(Status == \"Ontime\"), Overdue = countif(Status == \"Overdue\"),Unassigned = countif(Status == \"Unassigned\") by DisplayName = tostring(properties.displayName)\r\n| order by Completed, Ontime, Overdue, Unassigned asc",
            "size": 0,
            "title": "Assessments",
            "noDataMessage": "No Assessments found",
            "exportedParameters": [
              {
                "fieldName": "id",
                "parameterName": "id",
                "parameterType": 1
              },
              {
                "fieldName": "DisplayName",
                "parameterName": "DisplayName",
                "parameterType": 1
              }
            ],
            "showExportToExcel": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "DisplayName",
                  "formatter": 0,
                  "formatOptions": {
                    "customColumnWidthSetting": "75ch"
                  }
                },
                {
                  "columnMatch": "Completed",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "!=",
                        "thresholdValue": "0",
                        "representation": "success",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Blank",
                        "text": "{0}{1}"
                      }
                    ],
                    "customColumnWidthSetting": "15ch"
                  }
                },
                {
                  "columnMatch": "Ontime",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "!=",
                        "thresholdValue": "0",
                        "representation": "1",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Blank",
                        "text": "{0}{1}"
                      },
                      {
                        "representation": "Unknown",
                        "text": "{0}{1}"
                      }
                    ],
                    "customColumnWidthSetting": "15ch"
                  }
                },
                {
                  "columnMatch": "Overdue",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "!=",
                        "thresholdValue": "0",
                        "representation": "3",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Blank",
                        "text": "{0}{1}"
                      }
                    ],
                    "customColumnWidthSetting": "15ch"
                  }
                },
                {
                  "columnMatch": "Unassigned",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "!=",
                        "thresholdValue": "0",
                        "representation": "2",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Blank",
                        "text": "0"
                      }
                    ],
                    "customColumnWidthSetting": "15ch"
                  }
                },
                {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                {
                  "columnMatch": "id",
                  "formatter": 1,
                  "formatOptions": {
                    "customColumnWidthSetting": "90ch"
                  }
                },
                {
                  "columnMatch": "owner",
                  "formatter": 0,
                  "formatOptions": {
                    "customColumnWidthSetting": "40ch"
                  }
                },
                {
                  "columnMatch": "DueDate",
                  "formatter": 6
                },
                {
                  "columnMatch": "Severity",
                  "formatter": 5
                },
                {
                  "columnMatch": "Resource",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": "OpenBlade",
                    "linkIsContextBlade": false,
                    "showIcon": true,
                    "bladeOpenContext": {
                      "bladeName": "GenericResourceHealthDetailsBlade",
                      "extensionName": "Microsoft_Azure_Security",
                      "bladeParameters": [
                        {
                          "name": "resourceId",
                          "source": "cell",
                          "value": "%2Fsubscriptions%2F3b5bc982-20bc-4b59-b1ca-f8488bb86736%2FresourceGroups%2Fdemo%2Fproviders%2FMicrosoft.HybridCompute%2Fmachines%2FW2019"
                        }
                      ]
                    },
                    "customColumnWidthSetting": "20ch"
                  }
                },
                {
                  "columnMatch": "ResourceGroup",
                  "formatter": 14,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true,
                    "customColumnWidthSetting": "25ch"
                  }
                },
                {
                  "columnMatch": "Source",
                  "formatter": 0,
                  "formatOptions": {
                    "customColumnWidthSetting": "15ch"
                  }
                },
                {
                  "columnMatch": "OperatingSystem",
                  "formatter": 0,
                  "formatOptions": {
                    "customColumnWidthSetting": "25ch"
                  }
                },
                {
                  "columnMatch": "Category",
                  "formatter": 0,
                  "formatOptions": {
                    "customColumnWidthSetting": "20ch"
                  }
                },
                {
                  "columnMatch": "Remediation",
                  "formatter": 5
                },
                {
                  "columnMatch": "RemediationSteps",
                  "formatter": 11,
                  "formatOptions": {
                    "linkColumn": "Remediation",
                    "linkTarget": "Url"
                  },
                  "tooltipFormat": {
                    "tooltip": "Click to view remediation steps"
                  }
                },
                {
                  "columnMatch": "Code",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Healthy",
                        "representation": "success",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unhealthy",
                        "representation": "3",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "success",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                {
                  "columnMatch": "resourceGroup",
                  "formatter": 14,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                }
              ],
              "rowLimit": 10000,
              "filter": true,
              "sortBy": [
                {
                  "itemKey": "$gen_thresholds_Ontime_2",
                  "sortOrder": 2
                }
              ],
              "labelSettings": [
                {
                  "columnId": "DisplayName",
                  "label": "Display name"
                }
              ]
            },
            "sortBy": [
              {
                "itemKey": "$gen_thresholds_Ontime_2",
                "sortOrder": 2
              }
            ]
          },
          "customWidth": "80",
          "conditionalVisibility": {
            "parameterName": "Rule",
            "comparison": "isNotEqualTo"
          },
          "name": "Assessmetns"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "50",
                "conditionalVisibility": {
                  "parameterName": "RuleConditionSet",
                  "comparison": "isNotEqualTo"
                },
                "name": "empty text"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources         \r\n| where type == \"microsoft.security/assessments\"\r\n| where isnull(properties.resourceDetails.AwsResourceId) and isnull(properties.resourceDetails.GcpResourceId)\r\n| extend displayNameFilter = tostring(\"{DisplayName}\")\r\n| where displayNameFilter == tostring(properties.displayName)\r\n| join kind=leftouter   (securityresources         \r\n| where type == \"microsoft.security/assessments/governanceassignments\"\r\n| extend  assignedResourceId = tostring(todynamic(properties).assignedResourceId)\r\n| extend remediationDueDate = todatetime(properties.remediationDueDate)\r\n| project id = assignedResourceId, owner = properties.owner,governanceassignmentsProperties = todynamic(properties), remediationDueDate, isGrace = properties.isGracePeriod) on id\r\n| extend hasAssignment = isempty( governanceassignmentsProperties) == false and isnull( governanceassignmentsProperties) == false\r\n| extend assignmentStatus = iif(tostring(properties.status.code) == \"Unhealthy\",iif(hasAssignment == true, iif(bin(remediationDueDate, 1d) < bin(now(), 1d), \"Overdue\", \"Ontime\"), \"Unassigned\") , \"Completed\")\r\n| extend source = trim(' ', tolower(tostring(properties.resourceDetails.Source)))\r\n                                          | extend resourceId = iff(source =~ \"azure\", properties.resourceDetails.Id, iff(source =~ \"aws\" and isnotempty(tostring(properties.resourceDetails.ConnectorId)), properties.resourceDetails.Id, iff(source =~ \"gcp\" and isnotempty(tostring(properties.resourceDetails.ConnectorId)), properties.resourceDetails.Id, iff(source =~ 'aws', properties.resourceDetails.AzureResourceId, iff(source =~ 'gcp', properties.resourceDetails.AzureResourceId, properties.resourceDetails.Id)))))\r\n| project [\"Resource id\"] = resourceId, Subscription = subscriptionId ,Status = assignmentStatus, Owner = owner, [\"Due date\"] = remediationDueDate, [\"Grace period enabled\"] = isGrace\r\n| order by Status desc",
                        "size": 0,
                        "title": "List of resource for: {DisplayName}",
                        "noDataMessage": "No Assessments found",
                        "exportFieldName": "id",
                        "exportParameterName": "id",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Resource id",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true,
                                "customColumnWidthSetting": "90ch"
                              }
                            },
                            {
                              "columnMatch": "Subscription",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "Status",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Completed",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unassigned",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Overdue",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Ontime",
                                    "representation": "1",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": null,
                                    "text": "{0}{1}"
                                  }
                                ]
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "Grace period enabled",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "true",
                                    "representation": "success",
                                    "text": ""
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "false",
                                    "representation": "4",
                                    "text": ""
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Blank",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "owner",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "40ch"
                              }
                            },
                            {
                              "columnMatch": "DueDate",
                              "formatter": 6
                            },
                            {
                              "columnMatch": "id",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "90ch"
                              }
                            },
                            {
                              "columnMatch": "DisplayName",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "100ch"
                              }
                            },
                            {
                              "columnMatch": "Completed",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "green",
                                "customColumnWidthSetting": "15ch"
                              }
                            },
                            {
                              "columnMatch": "Ontime",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue",
                                "customColumnWidthSetting": "15ch"
                              }
                            },
                            {
                              "columnMatch": "Overdue",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "redBright",
                                "customColumnWidthSetting": "15ch"
                              }
                            },
                            {
                              "columnMatch": "Unassigned",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "orange",
                                "customColumnWidthSetting": "15ch"
                              }
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Resource",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkIsContextBlade": false,
                                "showIcon": true,
                                "bladeOpenContext": {
                                  "bladeName": "GenericResourceHealthDetailsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "resourceId",
                                      "source": "cell",
                                      "value": "%2Fsubscriptions%2F3b5bc982-20bc-4b59-b1ca-f8488bb86736%2FresourceGroups%2Fdemo%2Fproviders%2FMicrosoft.HybridCompute%2Fmachines%2FW2019"
                                    }
                                  ]
                                },
                                "customColumnWidthSetting": "20ch"
                              }
                            },
                            {
                              "columnMatch": "ResourceGroup",
                              "formatter": 14,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true,
                                "customColumnWidthSetting": "25ch"
                              }
                            },
                            {
                              "columnMatch": "Source",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "15ch"
                              }
                            },
                            {
                              "columnMatch": "OperatingSystem",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "25ch"
                              }
                            },
                            {
                              "columnMatch": "Category",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "20ch"
                              }
                            },
                            {
                              "columnMatch": "Remediation",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "RemediationSteps",
                              "formatter": 11,
                              "formatOptions": {
                                "linkColumn": "Remediation",
                                "linkTarget": "Url"
                              },
                              "tooltipFormat": {
                                "tooltip": "Click to view remediation steps"
                              }
                            },
                            {
                              "columnMatch": "Code",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Healthy",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unhealthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "resourceGroup",
                              "formatter": 14,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true
                        },
                        "sortBy": []
                      },
                      "conditionalVisibility": {
                        "parameterName": "DisplayName",
                        "comparison": "isNotEqualTo"
                      },
                      "name": "Assignments"
                    }
                  ]
                },
                "name": "assessmentsWithExplaination"
              },
              {
                "type": 1,
                "content": {
                  "json": "ðŸ’¡ Selected filter for **DisplayName:** {DisplayName}\r\n",
                  "style": "{selectedTab}"
                },
                "conditionalVisibility": {
                  "parameterName": "parameter1",
                  "comparison": "isEqualTo",
                  "value": "1"
                },
                "name": "ResourceFilter - Copy"
              }
            ]
          },
          "name": "assessmentsGrid"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "Azure Security Center"
      ],
      "styleSettings": {
        "paddingStyle": "narrow"
      },
      "fromTemplateId": "Governance (Preview)"
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}