{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Workbook 3",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "Azure Security Center",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "## Defender for Cloud Pricing Estimation Dashboard\nThis workbook has been created to provide a consolidated price estimation for Microsoft Defender for Cloud plans based on the resource telemetry in your own environment. Please note that these numbers can only be estimates based on retail prices and do not provide actual billing data."
          },
          "name": "text - 3"
        },
        {
          "type": 1,
          "content": {
            "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take the time to answer a quick survey. To submit your feedback,\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://aka.ms/MDFCCostEstimationSurvey)"
          },
          "name": "survey"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "ab70e406-2d42-4de6-98e4-bcf113428a86",
                "version": "KqlParameterItem/1.0",
                "name": "info",
                "label": "Additional information",
                "type": 10,
                "isRequired": true,
                "value": "On",
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "jsonData": "[[\n { \"value\": \"On\", \"label\": \"On\"},\n { \"value\": \"Off\", \"label\": \"Off\"}\n]",
                "timeContext": {
                  "durationMs": 86400000
                }
              }
            ],
            "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "K8sParam - Copy"
        },
        {
          "type": 1,
          "content": {
            "json": "Due to the limitations of Azure Monitor, you will only be able to see 10,000 rows at a time.",
            "style": "warning"
          },
          "name": "text - 13"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "2896eab7-cf93-43e5-bc43-92eba7c6bd80",
                "version": "KqlParameterItem/1.0",
                "name": "Subscriptions",
                "type": 6,
                "description": "Please select one or several subscriptions to allow the workbook to calculate Defender for Cloud cost.",
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "value": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "includeAll": true
                },
                "timeContext": {
                  "durationMs": 86400000
                }
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "parameters - 1"
        },
        {
          "type": 11,
          "content": {
            "version": "LinkItem/1.0",
            "style": "tabs",
            "links": [
              {
                "id": "f0901d7f-3e94-4520-a0ba-7c0a1087a7f0",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Overview",
                "subTarget": "Overview",
                "preText": "Overview",
                "style": "link"
              },
              {
                "id": "440616ea-8f0a-473b-a934-a8c33d80b24c",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Defender for App Services",
                "subTarget": "AppService",
                "style": "link"
              },
              {
                "id": "1e84b57e-12df-4e39-8542-1d993ad75dc2",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Defender for Containers",
                "subTarget": "Containers",
                "style": "link"
              },
              {
                "id": "d16f6d13-87aa-41dc-bf9c-42593629bf9a",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Defender for Databases",
                "subTarget": "SQL",
                "style": "link"
              },
              {
                "id": "a6b8b480-a724-427c-b613-ca985bc6ecd5",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Defender for Key Vaults",
                "subTarget": "KeyVault",
                "style": "link"
              },
              {
                "id": "cdadd86f-4c1e-4ef5-90f0-7550078a4673",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Defender for Servers",
                "subTarget": "Servers",
                "style": "link"
              },
              {
                "id": "9a8a9b40-f9e0-4963-892c-67ee3e6d4801",
                "cellValue": "SelectedView",
                "linkTarget": "parameter",
                "linkLabel": "Defender for Storage",
                "subTarget": "Storage",
                "style": "link"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "Subscriptions",
            "comparison": "isNotEqualTo"
          },
          "name": "Main menu"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "ca37db61-f9fd-4568-813e-96f434a7ec0a",
                      "version": "KqlParameterItem/1.0",
                      "name": "kubernetesCluster",
                      "label": "Kubernetes Cluster",
                      "type": 5,
                      "description": "Please select one or several Kubernetes clusters in your environment to calculate Defender for Containers estimated cost.",
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "where type =~ 'microsoft.containerservice/managedclusters' or type =~ 'microsoft.kubernetes/connectedclusters'\n",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": [
                        "value::all"
                      ]
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "conditionalVisibility": {
                  "parameterName": "SelectedView",
                  "comparison": "isEqualTo",
                  "value": "Containers"
                },
                "name": "Containers parameters"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for Containers"
                },
                "conditionalVisibility": {
                  "parameterName": "SelectedView",
                  "comparison": "isEqualTo",
                  "value": "Containers"
                },
                "name": "Containers heading"
              },
              {
                "type": 1,
                "content": {
                  "json": "Microsoft Defender for Containers is a new offering that consolidates two existing Microsoft Defender for Cloud meters:\n* Microsoft Defender for Kubernetes\n* Microsoft Defender for Container Registries\n\nIn addition, Microsoft Defender for Servers is no longer required for host-level protection of Kubernetes clusters as relevant node-level protection capabilities are added to the new plan, alongside new capabilities:\n\n* **New Kubernetes native deployment** - We developed a DaemonSet, which is deployed and maintained on the Kubernetes control plane. The new DaemonSet is responsible for all data collection events, supports any Kubernetes (Azure & non-Azure) and removes our current dependency on the Log Analytics agent. The DaemonSet gives customers visibility and management capabilities via Kubernetes tooling, and will resolve ongoing customer issues and challenges with the current VM extension model. It is integrated into Azure Kubernetes Service (AKS) as a Security profile and into Azure Arc connected clusters as a cluster extension for both on-prem and multi-cloud scenarios.\n* **Advanced Threat Protection** - additional Kubernetes-aware AI analytics and anomaly detection based on process signals. A full list of alerts is published in our [Reference table for all security alerts in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/defender-for-cloud/alerts-reference?WT.mc_id=Portal-fx#alerts-k8scluster).\n* **Runtime visibility of vulnerabilities** - A new Microsoft Defender for Cloud recommendation that monitors Kubernetes clusters will surface a list of running images with vulnerabilities based on vulnerability assessment scans powered by Qualys. This new recommendation can help customers focus on the most critical vulnerabilities that expose their runtime environments to security threats and attacks.\n\nThese tables consider all Kubernetes clusters with/without Microsoft Defender for Containers enabled across your selected subscriptions. The estimated price is based on the amount of average nodes in an AKS cluster, or on the number of CPU cores per Azure Arc-enabled Kubernetes cluster."
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "Containers text"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "d6920f39-dd7d-48ca-8148-067ccde06f2e",
                      "version": "KqlParameterItem/1.0",
                      "name": "K8s",
                      "label": "Environment",
                      "type": 10,
                      "isRequired": true,
                      "value": "AKS",
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "jsonData": "[[\n { \"value\": \"AKS\", \"label\": \"Azure Kubernetes Service\"},\n { \"value\": \"Arc\", \"label\": \"Azure Arc-enabled Kubernetes\"}\n]",
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    }
                  ],
                  "style": "above",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "conditionalVisibility": {
                  "parameterName": "kubernetesCluster",
                  "comparison": "isNotEqualTo"
                },
                "name": "Containers environment"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 10,
                      "content": {
                        "chartId": "workbooke5bc5546-74e4-4749-a0fb-3202517457fd",
                        "version": "MetricsItem/2.0",
                        "size": 4,
                        "chartType": 0,
                        "resourceType": "microsoft.containerservice/managedclusters",
                        "metricScope": 0,
                        "resourceParameter": "kubernetesCluster",
                        "resourceIds": [
                          "{kubernetesCluster}"
                        ],
                        "timeContext": {
                          "durationMs": 2592000000
                        },
                        "metrics": [
                          {
                            "namespace": "insights.container/nodes",
                            "metric": "insights.container/nodes--nodesCount",
                            "aggregation": 4
                          },
                          {
                            "namespace": "microsoft.containerservice/managedclusters",
                            "metric": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores",
                            "aggregation": 4
                          }
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Subscription",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Name",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource"
                              }
                            },
                            {
                              "columnMatch": "insights.container/nodes--nodesCount Timeline",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "insights.container/nodes--nodesCount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 0,
                                "options": null
                              }
                            },
                            {
                              "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition Timeline",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 0,
                                "options": null
                              }
                            },
                            {
                              "columnMatch": ".*\\/Statuses for various node conditions$",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores Timeline",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 0,
                                "options": null
                              }
                            }
                          ],
                          "rowLimit": 10000,
                          "labelSettings": [
                            {
                              "columnId": "insights.container/nodes--nodesCount",
                              "label": "nodesCount (Average)"
                            },
                            {
                              "columnId": "insights.container/nodes--nodesCount Timeline",
                              "label": "nodesCount Timeline"
                            },
                            {
                              "columnId": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores",
                              "label": "Total number of available cpu cores in a managed cluster (Average)"
                            },
                            {
                              "columnId": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores Timeline",
                              "label": "Total number of available cpu cores in a managed cluster Timeline"
                            }
                          ]
                        }
                      },
                      "customWidth": "10",
                      "conditionalVisibility": {
                        "parameterName": "blank",
                        "comparison": "isNotEqualTo"
                      },
                      "name": "containersMetric"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\n| where type =~ \"microsoft.containerservice/managedclusters\"\n| extend machineType = tostring(properties.agentPoolProfiles[0].vmSize), \n        nodesCount = toint(properties.agentPoolProfiles[0]['count']),\n        powerState = tostring(properties.agentPoolProfiles[0].powerState.code)\n| extend vCoresPerMachine = toint(extract_all(@\"(\\d+)\", machineType)[0])\n| extend coresTotal = vCoresPerMachine * nodesCount\n| extend estimatedMonthlyCost = coresTotal * 7\n| project id, subscriptionId, machineType, nodesCount, powerState, vCoresPerMachine, coresTotal, estimatedMonthlyCost",
                        "size": 4,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{kubernetesCluster}"
                        ]
                      },
                      "customWidth": "10",
                      "conditionalVisibility": {
                        "parameterName": "blank",
                        "comparison": "isNotEqualTo"
                      },
                      "name": "containersQuery"
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## Azure Kubernetes Service (AKS) clusters\n\nThis table provides an estimation for Microsoft Defender for Containers cost depending on the number CPU cores on worker nodes used in average during the last 30 days. If no average telemetry is available, estimation is calculated based on the number of nodes currently running in a cluster."
                      },
                      "name": "AKS text"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\",\"mergeType\":\"innerunique\",\"leftTable\":\"containersQuery\",\"rightTable\":\"containersMetric\",\"leftColumn\":\"id\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Total estimated Defender cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Total estimated Defender for Containers Cost\\\"\"}}]},{\"originalName\":\"[containersMetric].Name\",\"mergedName\":\"Name\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].id\",\"mergedName\":\"id\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].machineType\",\"mergedName\":\"machineType\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].nodesCount\",\"mergedName\":\"nodesCount\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].powerState\",\"mergedName\":\"powerState\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].vCoresPerMachine\",\"mergedName\":\"vCoresPerMachine\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersMetric].insights.container/nodes--nodesCount\",\"mergedName\":\"nodesCount (Average)\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersMetric].microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores\",\"mergedName\":\"averageCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[containersQuery].coresTotal\",\"mergedName\":\"coresTotal\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"freeScans\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"averageCores\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"averageCores\\\"] * 20\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"coresTotal\\\"] * 20\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated monthly price\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"averageCores\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"averageCores\\\"] * 7\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"estimatedMonthlyCost\"}}]},{\"originalName\":\"[containersQuery].estimatedMonthlyCost\",\"mergedName\":\"estimatedMonthlyCost\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersMetric].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersMetric].insights.container/nodes--nodesCount Timeline\",\"mergedName\":\"nodesCount Timeline\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a08d\"},{\"originalName\":\"[containersQuery].poolname\",\"mergedName\":\"poolname\",\"fromId\":\"unknown\"},{\"originalName\":\"[containersMetric].insights.container/nodes--nodesCount Timeline\"},{\"originalName\":\"[containersQuery].id\"},{\"originalName\":\"[containersQuery].name\"},{\"originalName\":\"[containersQuery].type\"},{\"originalName\":\"[containersQuery].tenantId\"},{\"originalName\":\"[containersQuery].kind\"},{\"originalName\":\"[containersQuery].maxMonthlyCost\"},{\"originalName\":\"[containersQuery].minMonthlyCost\"},{\"originalName\":\"[containersQuery].minMachineCount\"},{\"originalName\":\"[containersQuery].maxMachineCount\"},{\"originalName\":\"[containersQuery].extendedLocation\"},{\"originalName\":\"[containersQuery].zones\"},{\"originalName\":\"[containersQuery].identity\"},{\"originalName\":\"[containersQuery].tags\"},{\"originalName\":\"[containersQuery].properties\"},{\"originalName\":\"[containersQuery].plan\"},{\"originalName\":\"[containersQuery].sku\"},{\"originalName\":\"[containersQuery].managedBy\"},{\"originalName\":\"[containersQuery].resourceGroup\"},{\"originalName\":\"[containersQuery].location\"},{\"originalName\":\"[containersMetric].microsoft.containerservice/managedclusters-Nodes-kube_node_status_allocatable_cpu_cores Timeline\"}]}",
                        "size": 3,
                        "queryType": 7,
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "Total estimated Defender cost",
                              "formatter": 5,
                              "formatOptions": {
                                "aggregation": "Sum"
                              }
                            },
                            {
                              "columnMatch": "id",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "nodesCount",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "powerState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Running",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Stopped",
                                    "representation": "stopped",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "pending",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "vCoresPerMachine",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "nodesCount (Average)",
                              "formatter": 5,
                              "formatOptions": {
                                "aggregation": "Sum",
                                "customColumnWidthSetting": "19ch"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "averageCores",
                              "formatter": 0,
                              "formatOptions": {
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "coresTotal",
                              "formatter": 5,
                              "formatOptions": {
                                "aggregation": "Sum",
                                "customColumnWidthSetting": "22.28ch"
                              }
                            },
                            {
                              "columnMatch": "freeScans",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 0
                                }
                              },
                              "tooltipFormat": {
                                "tooltip": "Number of container images included for scanning based on the amount of vCores per Kubernetes cluster."
                              }
                            },
                            {
                              "columnMatch": "Estimated monthly price",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "estimatedMonthlyCost",
                              "formatter": 5,
                              "formatOptions": {
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency"
                                }
                              }
                            },
                            {
                              "columnMatch": "Subscription",
                              "formatter": 5
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "Total estimated Defender cost",
                              "Subscription"
                            ],
                            "expandTopLevel": true
                          },
                          "labelSettings": [
                            {
                              "columnId": "Total estimated Defender cost",
                              "label": "Subscription"
                            },
                            {
                              "columnId": "Name",
                              "label": "Cluster name"
                            },
                            {
                              "columnId": "machineType",
                              "label": "Azure VM size"
                            },
                            {
                              "columnId": "powerState",
                              "label": "Power State"
                            },
                            {
                              "columnId": "nodesCount (Average)",
                              "label": "Nodes (average)"
                            },
                            {
                              "columnId": "averageCores",
                              "label": "vCores (average)"
                            },
                            {
                              "columnId": "coresTotal",
                              "label": "Total cores (current)"
                            },
                            {
                              "columnId": "freeScans",
                              "label": "Container image scans included"
                            },
                            {
                              "columnId": "estimatedMonthlyCost",
                              "label": "Estimated monthly price"
                            }
                          ]
                        }
                      },
                      "name": "AKS result"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "kubernetesCluster",
                    "comparison": "isNotEqualTo"
                  },
                  {
                    "parameterName": "K8s",
                    "comparison": "isEqualTo",
                    "value": "AKS"
                  }
                ],
                "name": "AKS",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "## Azure Arc-enabled Kubernetes clusters\nThe table below shows a cost estimation for Microsoft Defender for Containers based on the number of cores that are configured in a non-AKS Kubernetes cluster, connected through Azure Arc."
                      },
                      "name": "ArcK8s text"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\n| where type == \"microsoft.kubernetes/connectedclusters\"\n| extend physicalCoresCount = properties.totalCoreCount\n| extend estimatedMonthlyCost = physicalCoresCount * 7\n| project clusterName = id, subscriptionId, toint(physicalCoresCount), estimatedMonthlyCost",
                        "size": 3,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ]
                      },
                      "customWidth": "10",
                      "conditionalVisibility": {
                        "parameterName": "blank",
                        "comparison": "isNotEqualTo"
                      },
                      "name": "ArcK8s query"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a0ca\",\"mergeType\":\"table\",\"leftTable\":\"arcQuery\"}],\"projectRename\":[{\"originalName\":\"[arcQuery].clusterName\",\"mergedName\":\"clusterName\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a0ca\"},{\"originalName\":\"[arcQuery].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a0ca\"},{\"originalName\":\"[arcQuery].physicalCoresCount\",\"mergedName\":\"physicalCoresCount\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a0ca\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"freeScans\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"physicalCoresCount\\\"] * 20\"}}]},{\"originalName\":\"[arcQuery].estimatedMonthlyCost\",\"mergedName\":\"estimatedMonthlyCost\",\"fromId\":\"14a965f5-e5c5-42b2-b0bd-382f9dc3a0ca\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Total estimated Defender cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"'Total estimated Defender cost'\"}}]}]}",
                        "size": 3,
                        "queryType": 7,
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "physicalCoresCount",
                              "formatter": 0,
                              "formatOptions": {
                                "aggregation": "Sum"
                              }
                            },
                            {
                              "columnMatch": "freeScans",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue",
                                "aggregation": "Sum"
                              }
                            },
                            {
                              "columnMatch": "estimatedMonthlyCost",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency"
                                }
                              }
                            },
                            {
                              "columnMatch": "Total estimated Defender cost",
                              "formatter": 5,
                              "formatOptions": {
                                "aggregation": "Sum"
                              }
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "Total estimated Defender cost",
                              "subscriptionId"
                            ],
                            "expandTopLevel": true
                          },
                          "labelSettings": [
                            {
                              "columnId": "clusterName",
                              "label": "Cluster name"
                            },
                            {
                              "columnId": "physicalCoresCount",
                              "label": "Number of vCores"
                            },
                            {
                              "columnId": "freeScans",
                              "label": "Container image scans included",
                              "comment": "Number of images included to be scanned at no additional cost"
                            },
                            {
                              "columnId": "estimatedMonthlyCost",
                              "label": "Estimated monthly price"
                            },
                            {
                              "columnId": "Total estimated Defender cost",
                              "label": "Subscription"
                            }
                          ]
                        }
                      },
                      "showPin": false,
                      "name": "ArcK8s result"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "kubernetesCluster",
                    "comparison": "isNotEqualTo"
                  },
                  {
                    "parameterName": "K8s",
                    "comparison": "isEqualTo",
                    "value": "Arc"
                  }
                ],
                "name": "ARCK8s",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "SelectedView",
              "comparison": "isEqualTo",
              "value": "Containers"
            },
            {
              "parameterName": "Subscriptions",
              "comparison": "isNotEqualTo"
            }
          ],
          "name": "Defender For Containers"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for Cloud coverage by subscriptions"
                },
                "name": "text - 1"
              },
              {
                "type": 1,
                "content": {
                  "json": "This table provides an overview of all selected subscriptions and their corresponding Defender status per plan. You can click the on/off status per plan and subscription. Doing so, you will be redirected to the subscription's Defender for Cloud plan configuration page. With that, you can easily see your Defender for Cloud coverage per subscription and immediately react in case you want to enable additional plans on it. "
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "text - 2"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources\n| where type =~ \"microsoft.security/pricings\"\n| extend planSet = pack(name, pricingTier = properties.pricingTier)\n| summarize defenderPlans = make_bag(planSet) by subscriptionId\n| project subscriptionId,\n    AppServices = defenderPlans.AppServices,\n    Arm = defenderPlans.Arm,\n    ContainerRegistry = defenderPlans.ContainerRegistry,\n    Containers = defenderPlans.Containers,\n    DNS = defenderPlans.Dns,\n    KeyVaults = defenderPlans.KeyVaults,\n    KubernetesService = defenderPlans.KubernetesService,\n    OpenSourceRelationalDatabases = defenderPlans.OpenSourceRelationalDatabases,\n    StorageAccounts = defenderPlans.StorageAccounts,\n    SqlServerVirtualMachines = defenderPlans.SqlServerVirtualMachines,\n    SqlServers = defenderPlans.SqlServers,\n    VirtualMachines = defenderPlans.VirtualMachines",
                  "size": 3,
                  "showAnalytics": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "subscriptionId",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true,
                          "customColumnWidthSetting": "50ch"
                        }
                      },
                      {
                        "columnMatch": "AppServices",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "linkIsContextBlade": false,
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "Arm",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "ContainerRegistry",
                        "formatter": 18,
                        "formatOptions": {
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "Containers",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "DNS",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "KeyVaults",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "KubernetesService",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "OpenSourceRelationalDatabases",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "StorageAccounts",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlServerVirtualMachines",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "SqlServers",
                        "formatter": 18,
                        "formatOptions": {
                          "linkColumn": "subscriptionId",
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "VirtualMachines",
                        "formatter": 18,
                        "formatOptions": {
                          "linkTarget": "OpenBlade",
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Standard",
                              "representation": "green",
                              "text": "on"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "off"
                            }
                          ],
                          "bladeOpenContext": {
                            "bladeName": "PolicyPricingWithBundlesBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "subscriptionId",
                                "source": "column",
                                "value": "subscriptionId"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "subscriptionName",
                        "formatter": 5,
                        "formatOptions": {
                          "linkTarget": "Resource"
                        }
                      }
                    ],
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_AppServices_1",
                        "sortOrder": 2
                      }
                    ],
                    "labelSettings": [
                      {
                        "columnId": "subscriptionId",
                        "label": "Subscription Name"
                      },
                      {
                        "columnId": "AppServices",
                        "label": "App Services"
                      },
                      {
                        "columnId": "Arm",
                        "label": "Resource Manager"
                      },
                      {
                        "columnId": "ContainerRegistry",
                        "label": "Container Registry (deprecated)"
                      },
                      {
                        "columnId": "Containers",
                        "label": "Containers"
                      },
                      {
                        "columnId": "DNS",
                        "label": "DNS"
                      },
                      {
                        "columnId": "KeyVaults",
                        "label": "Key Vaults"
                      },
                      {
                        "columnId": "KubernetesService",
                        "label": "K8s (deprecated)"
                      },
                      {
                        "columnId": "OpenSourceRelationalDatabases",
                        "label": "Open-source relational DBs"
                      },
                      {
                        "columnId": "StorageAccounts",
                        "label": "Storage"
                      },
                      {
                        "columnId": "SqlServerVirtualMachines",
                        "label": "SQL Server on machines"
                      },
                      {
                        "columnId": "SqlServers",
                        "label": "SQL"
                      },
                      {
                        "columnId": "VirtualMachines",
                        "label": "Servers"
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_thresholds_AppServices_1",
                      "sortOrder": 2
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "SelectedView",
                  "comparison": "isEqualTo",
                  "value": "Overview"
                },
                "name": "query - 4"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "SelectedView",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            {
              "parameterName": "Subscriptions",
              "comparison": "isNotEqualTo"
            }
          ],
          "name": "Overview"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "10694b7a-e599-4db7-99e0-1623a163b852",
                      "version": "KqlParameterItem/1.0",
                      "name": "AppServices",
                      "label": "App Services",
                      "type": 5,
                      "description": "Please select one or several App Services to calculate Defender for App Services estimated cost.",
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "where type =~ 'Microsoft.Web/sites'\n| order by name asc\n| extend Rank = row_number()\n| project value = id, label = id, selected = Rank <= 1000",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "value": [
                        "value::all"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "name": "parameters - 1"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for App Services\nThis table considers all App Services with/without Microsoft Defender for App Service enabled across your selected subscriptions. The telemetry results are taken from the last 7 days. The Estimated Price for 7 days is based on the hours the App Service was running; Estimated Monthly Price takes those 7 days as sample and calculates it for a month."
                },
                "name": "text - 0"
              },
              {
                "type": 1,
                "content": {
                  "json": "Price estimation is based on the retail price of [$0.02 USD per App Service per hour](https://azure.microsoft.com/pricing/calculator/).",
                  "style": "info"
                },
                "name": "text - 2"
              },
              {
                "type": 10,
                "content": {
                  "chartId": "workbook95e24bc5-6ed8-482f-aee2-d071d3c00ee9",
                  "version": "MetricsItem/2.0",
                  "size": 3,
                  "chartType": 0,
                  "resourceType": "microsoft.web/sites",
                  "metricScope": 0,
                  "resourceParameter": "AppServices",
                  "resourceIds": [
                    "{AppServices}"
                  ],
                  "timeContext": {
                    "durationMs": 604800000
                  },
                  "metrics": [],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Transactions Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.keyvault/vaults--ServiceApiHit",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/sites--CpuTime Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/sites--CpuTime",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 24,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/serverfarms--CpuPercentage Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/serverfarms--CpuPercentage",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 1,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/sites--Threads Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/sites--Threads",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/sites--Handles Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/sites--Handles",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/sites--FileSystemUsage Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/sites--FileSystemUsage",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 2,
                          "options": null
                        }
                      }
                    ],
                    "rowLimit": 10000
                  },
                  "sortBy": [],
                  "exportParameterName": "MetricsOutputParam"
                },
                "conditionalVisibility": {
                  "parameterName": "{blank}",
                  "comparison": "isEqualTo",
                  "value": "1"
                },
                "name": "metric - 0"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedView",
            "comparison": "isEqualTo",
            "value": "AppServices"
          },
          "name": "Defender For App Services"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "385da7a0-ce97-446b-95ab-9735f5e666b5",
                      "version": "KqlParameterItem/1.0",
                      "name": "TimeRange",
                      "label": "Time Range",
                      "type": 4,
                      "value": {
                        "durationMs": 604800000
                      },
                      "isHiddenWhenLocked": true,
                      "typeSettings": {
                        "selectableValues": [
                          {
                            "durationMs": 604800000
                          }
                        ]
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    },
                    {
                      "id": "9ed07b40-248b-4713-955a-9e7ad5d5c841",
                      "version": "KqlParameterItem/1.0",
                      "name": "AppService",
                      "type": 5,
                      "description": "Please select one or several App Service resources in your environment to calculate Defender for App Service estimated cost.",
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "resources\r\n| where type == \"microsoft.web/sites\"\r\n|project value = id",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "value": [
                        "value::all"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "name": "AppService parameters"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for App Service"
                },
                "name": "AppService heading"
              },
              {
                "type": 1,
                "content": {
                  "json": "This table considers all App Services with/without Microsoft Defender for App Service enabled across your selected subscriptions. The results are from the last 7 days. The Estimated Price for 7 days is based on the hours the App Service was running; Estimated Monthly Price takes those 7 days as sample and calculates it for a month."
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "AppService text"
              },
              {
                "type": 1,
                "content": {
                  "json": "### Price estimation is shown in the table below \r\nPrice estimation is based on the retail price of [$0.02 USD per App Service per hour](https://azure.microsoft.com/en-us/pricing/calculator/). The column titled \"Weekly Runtime\" is showing CPU time pulled from the past 7 days.",
                  "style": "info"
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "AppService banner"
              },
              {
                "type": 10,
                "content": {
                  "chartId": "workbook111925bd-7b17-4874-8cf3-fe3cf8977589",
                  "version": "MetricsItem/2.0",
                  "size": 0,
                  "chartType": 0,
                  "resourceType": "microsoft.web/sites",
                  "metricScope": 0,
                  "resourceParameter": "AppService",
                  "resourceIds": [
                    "{AppService}"
                  ],
                  "timeContextFromParameter": "TimeRange",
                  "timeContext": {
                    "durationMs": 0
                  },
                  "metrics": [
                    {
                      "namespace": "microsoft.web/sites",
                      "metric": "microsoft.web/sites--CpuTime",
                      "aggregation": 1
                    }
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource"
                        }
                      },
                      {
                        "columnMatch": "microsoft.keyvault/vaults--ServiceApiHit Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.keyvault/vaults--ServiceApiHit",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/sites--AverageResponseTime Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/sites--AverageResponseTime",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 24,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.web/sites--CpuTime Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.web/sites--CpuTime",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 24,
                          "options": null
                        }
                      }
                    ],
                    "rowLimit": 10000,
                    "labelSettings": [
                      {
                        "columnId": "microsoft.web/sites--CpuTime",
                        "label": "CPU Time (Sum)"
                      },
                      {
                        "columnId": "microsoft.web/sites--CpuTime Timeline",
                        "label": "CPU Time Timeline"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "{blank}",
                  "comparison": "isEqualTo",
                  "value": "0"
                },
                "name": "AppService metric"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"5d53c9ab-e18d-4145-83f5-e0f549c18313\",\"mergeType\":\"table\",\"leftTable\":\"metric - 3\"}],\"projectRename\":[{\"originalName\":\"[metric - 3].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"5d53c9ab-e18d-4145-83f5-e0f549c18313\"},{\"originalName\":\"[metric - 3].Name\",\"mergedName\":\"Name\",\"fromId\":\"5d53c9ab-e18d-4145-83f5-e0f549c18313\"},{\"originalName\":\"[metric - 3].microsoft.web/sites--CpuTime\",\"mergedName\":\"CPU Time (Sum)\",\"fromId\":\"5d53c9ab-e18d-4145-83f5-e0f549c18313\"},{\"originalName\":\"[metric - 3].microsoft.web/sites--CpuTime Timeline\",\"mergedName\":\"CPU Time Timeline\",\"fromId\":\"5d53c9ab-e18d-4145-83f5-e0f549c18313\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"CPU Time\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"CPU Time (Sum)\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"CPU Time (Sum)\\\"])/3600\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated Price (7 days)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"CPU Time\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"CPU Time\\\"]*0.02\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Total Estimated Cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Total Estimated Cost\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated Monthly Price\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Estimated Price (7 days)\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Estimated Price (7 days)\\\"]*4.35\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]}]}",
                  "size": 3,
                  "queryType": 7,
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true,
                          "customColumnWidthSetting": "51ch"
                        }
                      },
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "CPU Time (Sum)",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "CPU Time Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "CPU Time",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 26,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "Estimated Price (7 days)",
                        "formatter": 3,
                        "formatOptions": {
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "useGrouping": true,
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      {
                        "columnMatch": "Total Estimated Cost",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Estimated Monthly Price",
                        "formatter": 3,
                        "formatOptions": {
                          "palette": "yellow",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    ],
                    "rowLimit": 10000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "Total Estimated Cost",
                        "Subscription"
                      ],
                      "expandTopLevel": false
                    },
                    "labelSettings": [
                      {
                        "columnId": "Name",
                        "label": "App Service"
                      },
                      {
                        "columnId": "CPU Time",
                        "label": "Weekly Runtime"
                      },
                      {
                        "columnId": "Total Estimated Cost",
                        "label": "Subscription"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "AppService",
                  "comparison": "isNotEqualTo"
                },
                "name": "AppService result"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedView",
            "comparison": "isEqualTo",
            "value": "AppService"
          },
          "name": "Defender for App Service"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "93f036b1-8fc5-48ac-9645-d7dd1e416354",
                      "version": "KqlParameterItem/1.0",
                      "name": "Storage",
                      "type": 5,
                      "description": "Please select one or several Storage accounts in your environment to calculate Defender for Storage estimated cost.",
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "where type =~ 'microsoft.storage/storageaccounts'\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "value": [
                        "value::all"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                      "id": "5a10dfcf-57df-4e91-96f7-3363b76bc378",
                      "version": "KqlParameterItem/1.0",
                      "name": "TimeRange",
                      "label": "Time Range",
                      "type": 4,
                      "value": {
                        "durationMs": 604800000
                      },
                      "isHiddenWhenLocked": true,
                      "typeSettings": {
                        "selectableValues": [
                          {
                            "durationMs": 604800000
                          }
                        ]
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "name": "Storage parameters"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for Storage"
                },
                "name": "Storage heading"
              },
              {
                "type": 1,
                "content": {
                  "json": "This table considers all storage accounts with/without Defender for Storage enabled across your selected subscriptions. The results are from the last 7 days. The Estimated Price for 7 days is based on the number of transactions performed. Estimated Monthly Price takes those 7 days as sample and calculates it for a month. Learn more about this workbook [here](https://techcommunity.microsoft.com/t5/microsoft-defender-for-cloud/microsoft-defender-for-storage-price-estimation-dashboard/ba-p/2429724).\n\nTo pull the Blob and File transactions metric from each storage account in larger subcriptions or across a tenant use [Read Azure Storage Transaction Metrics](https://github.com/Azure/Azure-Security-Center/tree/main/Powershell%20scripts/Read%20Azure%20Storage%20Transaction%20Metrics)"
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "Storage text"
              },
              {
                "type": 1,
                "content": {
                  "json": "### Price estimation is shown in the table below \r\nPrice estimation is based on the retail price of [$0.02 USD per 10,000 transactions](https://azure.microsoft.com/en-us/pricing/calculator/). Currently protects Azure Blobs, Azure Files, and Azure Data Lake Storage Gen 2.",
                  "style": "info"
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "Storage banner"
              },
              {
                "type": 10,
                "content": {
                  "chartId": "workbookfd7723d0-8145-4a7c-80d3-38f50e6aa199",
                  "version": "MetricsItem/2.0",
                  "size": 0,
                  "chartType": 0,
                  "resourceType": "microsoft.storage/storageaccounts",
                  "metricScope": 0,
                  "resourceParameter": "Storage",
                  "resourceIds": [
                    "{Storage}"
                  ],
                  "timeContext": {
                    "durationMs": 604800000
                  },
                  "metrics": [
                    {
                      "namespace": "microsoft.storage/storageaccounts/blobservices",
                      "metric": "microsoft.storage/storageaccounts/blobservices-Transaction-Transactions",
                      "aggregation": 1
                    },
                    {
                      "namespace": "microsoft.storage/storageaccounts/fileservices",
                      "metric": "microsoft.storage/storageaccounts/fileservices-Transaction-Transactions",
                      "aggregation": 1
                    }
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource"
                        }
                      },
                      {
                        "columnMatch": "microsoft.storage/storageaccounts/blobservices-Transaction-Transactions Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.storage/storageaccounts/blobservices-Transaction-Transactions",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      },
                      {
                        "columnMatch": "microsoft.storage/storageaccounts/fileservices-Transaction-Transactions Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.storage/storageaccounts/fileservices-Transaction-Transactions",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      }
                    ],
                    "rowLimit": 10000,
                    "labelSettings": [
                      {
                        "columnId": "microsoft.storage/storageaccounts/blobservices-Transaction-Transactions",
                        "label": "Transactions (Sum)"
                      },
                      {
                        "columnId": "microsoft.storage/storageaccounts/blobservices-Transaction-Transactions Timeline",
                        "label": "Transactions Timeline"
                      },
                      {
                        "columnId": "microsoft.storage/storageaccounts/fileservices-Transaction-Transactions",
                        "label": "Transactions (Sum)"
                      },
                      {
                        "columnId": "microsoft.storage/storageaccounts/fileservices-Transaction-Transactions Timeline",
                        "label": "Transactions Timeline"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "{blank}",
                  "comparison": "isEqualTo",
                  "value": "0"
                },
                "name": "Storage metric"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"5981c845-296b-4080-ac40-7d086cdf733b\",\"mergeType\":\"table\",\"leftTable\":\"metric - 2\"}],\"projectRename\":[{\"originalName\":\"[metric - 2].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf733b\"},{\"originalName\":\"[metric - 2].Name\",\"mergedName\":\"Name\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf733b\"},{\"originalName\":\"[metric - 2].microsoft.storage/storageaccounts/blobservices-Transaction-Transactions\",\"mergedName\":\"BlobTransactionsOriginal\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf733b\"},{\"originalName\":\"[metric - 2].microsoft.storage/storageaccounts/fileservices-Transaction-Transactions\",\"mergedName\":\"FileTransactionsOriginal\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf733b\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"FileTransactions\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"FileTransactionsOriginal\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"FileTransactionsOriginal\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"BlobTransactions\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"BlobTransactionsOriginal\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"BlobTransactionsOriginal\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated Price (7 days)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"FileTransactions\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"BlobTransactions\\\"]+[\\\"FileTransactions\\\"])/10000*0.02\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Total Estimated Cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Total Estimated Storage Cost\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated Monthly Cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"BlobTransactions\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"BlobTransactions\\\"]+[\\\"FileTransactions\\\"])/({TimeRange:seconds}/86400)*30/10000*0.02\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[metric - 2].microsoft.storage/storageaccounts/blobservices-Transaction-Transactions Timeline\"},{\"originalName\":\"[metric - 2].microsoft.storage/storageaccounts/fileservices-Transaction-Transactions Timeline\"}]}",
                  "size": 3,
                  "queryType": 7,
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true,
                          "customColumnWidthSetting": "51ch"
                        }
                      },
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "BlobTransactionsOriginal",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "FileTransactionsOriginal",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "FileTransactions",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "BlobTransactions",
                        "formatter": 0,
                        "formatOptions": {
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      {
                        "columnMatch": "Estimated Price (7 days)",
                        "formatter": 3,
                        "formatOptions": {
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "useGrouping": true,
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      {
                        "columnMatch": "Total Estimated Cost",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Estimated Monthly Cost",
                        "formatter": 3,
                        "formatOptions": {
                          "palette": "yellow",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "useGrouping": false,
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    ],
                    "rowLimit": 10000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "Total Estimated Cost",
                        "Subscription"
                      ]
                    },
                    "labelSettings": [
                      {
                        "columnId": "Name",
                        "label": "Storage Account"
                      },
                      {
                        "columnId": "Total Estimated Cost",
                        "label": "Subscription"
                      },
                      {
                        "columnId": "Estimated Monthly Cost",
                        "label": "Estimated Monthly Price"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "Storage",
                  "comparison": "isNotEqualTo"
                },
                "name": "Storage query"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedView",
            "comparison": "isEqualTo",
            "value": "Storage"
          },
          "name": "Defender for Storage"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "654125f4-de00-4b20-ad9e-ef2e019195e9",
                      "version": "KqlParameterItem/1.0",
                      "name": "Workspace",
                      "type": 5,
                      "description": "Log Analytics Workspace",
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id\r\n",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "value": [
                        "value::all"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "name": "Servers parameters"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for Servers"
                },
                "name": "Servers heading"
              },
              {
                "type": 1,
                "content": {
                  "json": "This table considers all servers that are on with/without Microsoft Defender for Servers enabled across your selected subscriptions. The results are from the last 7 days. Estimated Monthly Cost takes those 7 days as sample and calculates it for a month.\n\nThe table includes estimations for Azure and hybrid serveres connected through Azure Arc as well as VMSS. If the machine is already connected to a Log Analytics workspace, the workbook takes the total number of hours the machine has been running in the past 7 days. For machines not connected to a workspace, the estimation is based on the machine running 24hrs a day."
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "Servers text"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "8a6df655-393e-4ea8-a704-d8183d0a7720",
                      "version": "KqlParameterItem/1.0",
                      "name": "ServersPlan",
                      "label": "Servers Plan",
                      "type": 10,
                      "isRequired": true,
                      "value": "P1",
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "jsonData": "[[\r\n { \"value\": \"P1\", \"label\": \"Defender for Servers Plan 1\"},\r\n { \"value\": \"P2\", \"label\": \"Defender for Servers Plan 2\"}\r\n]",
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    }
                  ],
                  "style": "above",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "name": "Servers plans"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "### Price estimation is shown in the table below\r\nThe price estimation is based on the retail price of [$0.02 per server/hour](https://azure.microsoft.com/en-us/pricing/calculator/). As mentioned above, the calculation looks at machines connected to a Log Analytics workspace to get historical data for the total number of hour over the past 7 days. If that data is not available, the calculation assumes the machine is running 24/7. The column titled \"Weekly Runtime\" is looking at the total weekly running hours of the virtual machine. ",
                        "style": "info"
                      },
                      "conditionalVisibility": {
                        "parameterName": "info",
                        "comparison": "isEqualTo",
                        "value": "On"
                      },
                      "name": "ServersP2 banner"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines' or type == 'microsoft.hybridcompute/machines' or type == \"microsoft.compute/virtualmachinescalesets\"\r\n| summarize by subscriptionId, name, type\r\n",
                        "size": 0,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "visualization": "table",
                        "gridSettings": {
                          "rowLimit": 10000
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "{blank}",
                        "comparison": "isEqualTo",
                        "value": "0"
                      },
                      "name": "ServersP2 query"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": " Heartbeat\r\n| where TimeGenerated > ago(7d) and ResourceProvider in ('Microsoft.Compute', 'Microsoft.HybridCompute') and Computer !contains \".\"\r\n| summarize heartbeats_per_hour=count() by bin(TimeGenerated, 1h), Computer, SubscriptionId\r\n| extend state_per_hour=iff(heartbeats_per_hour>0, true, false)\r\n| summarize total_running_hours=countif(state_per_hour==true) by Computer, SubscriptionId\r\n| where total_running_hours > 0 and isnotempty (SubscriptionId)",
                        "size": 0,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "rowLimit": 10000
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "{blank}",
                        "comparison": "isEqualTo",
                        "value": "0"
                      },
                      "name": "ServersP2 query 2"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\",\"mergeType\":\"outer\",\"leftTable\":\"query - 2\",\"rightTable\":\"query - 3\",\"leftColumn\":\"name\",\"rightColumn\":\"Computer\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Total estimated Defender cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Total estimated Defender cost\\\"\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"SubId\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"subscriptionId\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"subscriptionId\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"SubscriptionId\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"machineName\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"name\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"name\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"Computer\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"weeklyRuntime\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"total_running_hours\",\"operator\":\">\",\"rightValType\":\"static\",\"rightVal\":\"168\",\"resultValType\":\"expression\",\"resultVal\":\"24*7\"}},{\"criteriaContext\":{\"leftOperand\":\"total_running_hours\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"total_running_hours\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"24*7\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated price (7 days)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"weeklyRuntime\\\"] * 0.02\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated monthly price\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Estimated price (7 days)\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Estimated price (7 days)\\\"]*4.345\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - 2].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 2].name\",\"mergedName\":\"name\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 2].type\",\"mergedName\":\"type\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].SubscriptionId\",\"mergedName\":\"SubscriptionId\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].total_running_hours\",\"mergedName\":\"total_running_hours\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 3].heartbeats_per_hour\",\"mergedName\":\"heartbeats_per_hour\",\"fromId\":\"unknown\"}]}",
                        "size": 0,
                        "queryType": 7,
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "linkIsContextBlade": true,
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "Total estimated Defender cost",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "SubId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "machineName",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "Estimated price (7 days)",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "Estimated monthly price",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "type",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Computer",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "SubscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "total_running_hours",
                              "formatter": 5
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "Total estimated Defender cost",
                              "SubId"
                            ],
                            "expandTopLevel": true
                          },
                          "labelSettings": [
                            {
                              "columnId": "Total estimated Defender cost",
                              "label": "Subscription"
                            },
                            {
                              "columnId": "machineName",
                              "label": "Machine name"
                            },
                            {
                              "columnId": "weeklyRuntime",
                              "label": "Weekly runtime"
                            }
                          ]
                        },
                        "sortBy": []
                      },
                      "showPin": false,
                      "name": "ServersP2 result"
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "ServersPlan",
                  "comparison": "isEqualTo",
                  "value": "P2"
                },
                "name": "Plan2"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "### Price estimation is shown in the table below\r\nThe price estimation is based on the retail price of [$0.007 per server/hour](https://azure.microsoft.com/en-us/pricing/calculator/). As mentioned above, the calculation looks at machines connected to a Log Analytics workspace to get historical data for the total number of hour over the past 7 days. If that data is not available, the calculation assumes the machine is running 24/7. The column titled \"Weekly Runtime\" is looking at the total weekly running hours of the virtual machine. ",
                        "style": "info"
                      },
                      "conditionalVisibility": {
                        "parameterName": "info",
                        "comparison": "isEqualTo",
                        "value": "On"
                      },
                      "name": "ServersP1 banner"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines' or type == 'microsoft.hybridcompute/machines' or type == \"microsoft.compute/virtualmachinescalesets\"\r\n| summarize by subscriptionId, name, type\r\n",
                        "size": 0,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "visualization": "table",
                        "gridSettings": {
                          "rowLimit": 10000
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "{blank}",
                        "comparison": "isEqualTo",
                        "value": "0"
                      },
                      "name": "Servers query"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": " Heartbeat\r\n| where TimeGenerated > ago(7d) and ResourceProvider in ('Microsoft.Compute', 'Microsoft.HybridCompute') and Computer !contains \".\"\r\n| summarize heartbeats_per_hour=count() by bin(TimeGenerated, 1h), Computer, SubscriptionId\r\n| extend state_per_hour=iff(heartbeats_per_hour>0, true, false)\r\n| summarize total_running_hours=countif(state_per_hour==true) by Computer, SubscriptionId\r\n| where total_running_hours > 0 and isnotempty (SubscriptionId)",
                        "size": 0,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "rowLimit": 10000
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "{blank}",
                        "comparison": "isEqualTo",
                        "value": "0"
                      },
                      "name": "Servers query 2"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\",\"mergeType\":\"outer\",\"leftTable\":\"query - 2\",\"rightTable\":\"query - 3\",\"leftColumn\":\"name\",\"rightColumn\":\"Computer\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Total estimated Defender cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Total estimated Defender cost\\\"\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"SubId\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"subscriptionId\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"subscriptionId\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"SubscriptionId\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"machineName\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"name\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"name\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"Computer\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"weeklyRuntime\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"total_running_hours\",\"operator\":\">\",\"rightValType\":\"static\",\"rightVal\":\"168\",\"resultValType\":\"expression\",\"resultVal\":\"24*7\"}},{\"criteriaContext\":{\"leftOperand\":\"total_running_hours\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"total_running_hours\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"24*7\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated price (7 days)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"weeklyRuntime\\\"] * 0.00672\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated monthly price\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Estimated price (7 days)\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Estimated price (7 days)\\\"]*4.345\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - 2].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 2].name\",\"mergedName\":\"name\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 2].type\",\"mergedName\":\"type\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].SubscriptionId\",\"mergedName\":\"SubscriptionId\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].total_running_hours\",\"mergedName\":\"total_running_hours\",\"fromId\":\"70774d0c-4d25-4bae-9d9b-bcbcf8a39057\"},{\"originalName\":\"[query - 3].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 3].heartbeats_per_hour\",\"mergedName\":\"heartbeats_per_hour\",\"fromId\":\"unknown\"}]}",
                        "size": 0,
                        "queryType": 7,
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "linkIsContextBlade": true,
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "Total estimated Defender cost",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "SubId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "machineName",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "Estimated price (7 days)",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "Estimated monthly price",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "type",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "Computer",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "SubscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "total_running_hours",
                              "formatter": 5
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "Total estimated Defender cost",
                              "SubId"
                            ],
                            "expandTopLevel": true
                          },
                          "labelSettings": [
                            {
                              "columnId": "Total estimated Defender cost",
                              "label": "Subscription"
                            },
                            {
                              "columnId": "machineName",
                              "label": "Machine name"
                            },
                            {
                              "columnId": "weeklyRuntime",
                              "label": "Weekly runtime"
                            }
                          ]
                        },
                        "sortBy": []
                      },
                      "showPin": false,
                      "name": "ServersP1 result"
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "ServersPlan",
                  "comparison": "isEqualTo",
                  "value": "P1"
                },
                "name": "Plan 1"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedView",
            "comparison": "isEqualTo",
            "value": "Servers"
          },
          "name": "Defender for Servers"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "10694b7a-e599-4db7-99e0-1623a163b852",
                      "version": "KqlParameterItem/1.0",
                      "name": "KeyVault",
                      "type": 5,
                      "description": "Please select one or several Azure Key Vaults to calculate Defender for Key Vault estimated cost.",
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "where type =~ 'Microsoft.KeyVault/vaults'\n| order by name asc\n| extend Rank = row_number()\n| project value = id, label = id, selected = Rank <= 1000",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": [
                        "value::all"
                      ]
                    },
                    {
                      "id": "384d46ff-c1bb-443f-a40d-441a06d678ec",
                      "version": "KqlParameterItem/1.0",
                      "name": "TimeRange",
                      "label": "Time Range",
                      "type": 4,
                      "value": {
                        "durationMs": 604800000
                      },
                      "isHiddenWhenLocked": true,
                      "typeSettings": {
                        "selectableValues": [
                          {
                            "durationMs": 604800000
                          }
                        ]
                      }
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "name": "KeyVault parameters"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for Key Vault"
                },
                "name": "KeyVault heading"
              },
              {
                "type": 1,
                "content": {
                  "json": "This table considers all Azure Key Vaults with/without Microsoft Defender for Key Vault enabled across your selected subscriptions. The telemetry results are taken from the last 7 days. The Estimated Price for 7 days is based on the hours the App Service was running; Estimated Monthly Price takes those 7 days as sample and calculates it for a month."
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "KeyVault text"
              },
              {
                "type": 1,
                "content": {
                  "json": "### Price estimation is shown in the table below \r\nPrice estimation is based on the retail price of [$0.02 USD per 10,000 transactions](https://azure.microsoft.com/pricing/calculator/).",
                  "style": "info"
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "KeyVault banner"
              },
              {
                "type": 10,
                "content": {
                  "chartId": "workbooka57de9de-a2a9-4c9d-ac51-9a03867a51ff",
                  "version": "MetricsItem/2.0",
                  "size": 0,
                  "chartType": 0,
                  "resourceType": "microsoft.keyvault/vaults",
                  "metricScope": 0,
                  "resourceParameter": "KeyVault",
                  "resourceIds": [
                    "{KeyVault}"
                  ],
                  "timeContextFromParameter": "TimeRange",
                  "timeContext": {
                    "durationMs": 0
                  },
                  "metrics": [
                    {
                      "namespace": "microsoft.keyvault/vaults",
                      "metric": "microsoft.keyvault/vaults--ServiceApiHit",
                      "aggregation": 1
                    }
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource"
                        }
                      },
                      {
                        "columnMatch": "microsoft.keyvault/vaults--ServiceApiHit Timeline",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "microsoft.keyvault/vaults--ServiceApiHit",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 0,
                          "options": null
                        }
                      }
                    ],
                    "rowLimit": 10000,
                    "labelSettings": [
                      {
                        "columnId": "microsoft.keyvault/vaults--ServiceApiHit",
                        "label": "Total Service Api Hits (Sum)"
                      },
                      {
                        "columnId": "microsoft.keyvault/vaults--ServiceApiHit Timeline",
                        "label": "Total Service Api Hits Timeline"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "{blank}",
                  "comparison": "isEqualTo",
                  "value": "0"
                },
                "name": "KeyVault metric"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"5981c845-296b-4080-ac40-7d086cdf746e\",\"mergeType\":\"table\",\"leftTable\":\"metric - 3\"}],\"projectRename\":[{\"originalName\":\"[metric - 3].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf746e\"},{\"originalName\":\"[metric - 3].Name\",\"mergedName\":\"Name\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf746e\"},{\"originalName\":\"[metric - 3].microsoft.keyvault/vaults--ServiceApiHit\",\"mergedName\":\"TransactionsOriginal\",\"fromId\":\"5981c845-296b-4080-ac40-7d086cdf746e\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Transactions\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"TransactionsOriginal\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"TransactionsOriginal\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Total Estimated KeyVault Cost\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Total Estimated Defender for Key Vault Cost\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated Price (7 days)\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Transactions\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"Transactions\\\"])/10000*0.02\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Estimated Monthly Price\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Transactions\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"Transactions\\\"])/({TimeRange:seconds}/86400)*30/10000*0.02\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[metric - 3].microsoft.keyvault/vaults--ServiceApiHit Timeline\"}]}",
                  "size": 3,
                  "queryType": 7,
                  "visualization": "table",
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "$gen_group",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true,
                          "customColumnWidthSetting": "51ch"
                        }
                      },
                      {
                        "columnMatch": "Subscription",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Name",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "TransactionsOriginal",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Total Estimated KeyVault Cost",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "Estimated Price (7 days)",
                        "formatter": 3,
                        "formatOptions": {
                          "palette": "blue",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      {
                        "columnMatch": "Estimated Monthly Price",
                        "formatter": 3,
                        "formatOptions": {
                          "palette": "yellow",
                          "aggregation": "Sum"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    ],
                    "rowLimit": 10000,
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "Total Estimated KeyVault Cost",
                        "Subscription"
                      ],
                      "expandTopLevel": true
                    },
                    "labelSettings": [
                      {
                        "columnId": "Name",
                        "label": "Key Vault"
                      },
                      {
                        "columnId": "Total Estimated KeyVault Cost",
                        "label": "Subscription"
                      }
                    ]
                  }
                },
                "showPin": false,
                "name": "KeyVault query"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedView",
            "comparison": "isEqualTo",
            "value": "KeyVault"
          },
          "name": "Defender for Key Vault"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "## Microsoft Defender for Databases"
                },
                "name": "Databases heading"
              },
              {
                "type": 1,
                "content": {
                  "json": "This section considers all SQL servers and databases across your selected subscriptions. The results are measured from the last 7 days. Estimated Monthly Price takes those 7 days as sample and calculates it for a month.\nYou can select estimations for open-source relational databases, SQL servers on machines and Azure SQL databases. "
                },
                "conditionalVisibility": {
                  "parameterName": "info",
                  "comparison": "isEqualTo",
                  "value": "On"
                },
                "name": "Databases text"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "ff79ee98-e396-4b68-91f3-90a9185f257f",
                      "version": "KqlParameterItem/1.0",
                      "name": "SQLResources",
                      "label": "Environment",
                      "type": 10,
                      "isRequired": true,
                      "value": "Databases",
                      "typeSettings": {
                        "additionalResourceOptions": [],
                        "showDefault": false
                      },
                      "jsonData": "[[\r\n { \"value\": \"Databases\", \"label\": \"Defender for SQL on Azure SQL Databases\"},\r\n { \"value\": \"Machines\", \"label\": \"Defender for SQL servers on machines\"},\r\n { \"value\": \"OSS\", \"label\": \"Open source relational databases\"}\r\n]",
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    }
                  ],
                  "style": "above",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "name": "Databases parameters"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "### Price estimation is shown in the table below \r\nThis table takes into account all SQL Servers on Azure Virtual Machines to calculate the monthly price based on the retail price of [$15 USD per machine](https://azure.microsoft.com/pricing/calculator/).",
                        "style": "info"
                      },
                      "conditionalVisibility": {
                        "parameterName": "info",
                        "comparison": "isEqualTo",
                        "value": "On"
                      },
                      "name": "SQLServer banner"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n| where type == \"microsoft.sqlvirtualmachine/sqlvirtualmachines\" or type == \"microsoft.azurearcdata/sqlserverinstances\"\r\n|summarize by id, subscriptionId\r\n|extend monthlyCost = 1 * 15\r\n|extend TotalEstimatedCost = \"Total Estimated Cost\"",
                        "size": 3,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "monthlyCost",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "TotalEstimatedCost",
                              "formatter": 5,
                              "formatOptions": {
                                "aggregation": "Sum"
                              }
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "TotalEstimatedCost",
                              "subscriptionId"
                            ]
                          },
                          "labelSettings": [
                            {
                              "columnId": "id",
                              "label": "Server"
                            },
                            {
                              "columnId": "subscriptionId",
                              "label": "Subscription"
                            },
                            {
                              "columnId": "monthlyCost",
                              "label": "Estimated Monthly Price"
                            },
                            {
                              "columnId": "TotalEstimatedCost",
                              "label": "Subscription"
                            }
                          ]
                        }
                      },
                      "name": "SQLServer query"
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "SQLResources",
                  "comparison": "isEqualTo",
                  "value": "Machines"
                },
                "name": "SQLServer "
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "### Price estimation is shown in the table below \r\nPrice estimation is based on the retail price of [$15 USD per server](https://azure.microsoft.com/pricing/calculator/). This calculation includes Azure Database for PostgreSQL, Azure Database for MySQL single server and Azure Database for MariaDB single server. ",
                        "style": "info"
                      },
                      "conditionalVisibility": {
                        "parameterName": "info",
                        "comparison": "isEqualTo",
                        "value": "On"
                      },
                      "name": "OSRDB text"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n| where type == \"microsoft.dbformysql/servers\"  or type == \"microsoft.dbforpostgresql/servers\" or type == \"microsoft.dbformariadb/servers\"\r\n|summarize by id, subscriptionId\r\n|extend TotalEstimatedCost= \"Total Estimated Cost\"\r\n|extend EstimatedMonthlyPrice = 1 *15",
                        "size": 3,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "TotalEstimatedCost",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "EstimatedMonthlyPrice",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "type",
                              "formatter": 16,
                              "formatOptions": {
                                "showIcon": true
                              }
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "TotalEstimatedCost",
                              "subscriptionId"
                            ]
                          },
                          "labelSettings": [
                            {
                              "columnId": "id",
                              "label": "Server"
                            },
                            {
                              "columnId": "TotalEstimatedCost",
                              "label": "Subscription"
                            },
                            {
                              "columnId": "EstimatedMonthlyPrice",
                              "label": "Estimated Monthly Price"
                            }
                          ]
                        }
                      },
                      "name": "OSRDB query"
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "SQLResources",
                  "comparison": "isEqualTo",
                  "value": "OSS"
                },
                "name": "OSRDB"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "### Price estimation is shown in the table below \r\nPrice estimation is based on the retail price of [$15 USD per server](https://azure.microsoft.com/pricing/calculator/). This calculation includes Azure SQL Servers.",
                        "style": "info"
                      },
                      "conditionalVisibility": {
                        "parameterName": "info",
                        "comparison": "isEqualTo",
                        "value": "On"
                      },
                      "name": "SQLDB banner"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n| where type == \"microsoft.sql/servers\"\r\n|summarize by subscriptionId, id\r\n|extend TotalEstimatedCost= \"Total Estimated Cost\"\r\n|extend EstimatedMonthlyPrice = 1 *15",
                        "size": 3,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscriptions}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true,
                                "customColumnWidthSetting": "51ch"
                              }
                            },
                            {
                              "columnMatch": "subscriptionId",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "TotalEstimatedCost",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "EstimatedMonthlyPrice",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "yellow",
                                "aggregation": "Sum"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "currency": "USD",
                                  "style": "currency"
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "type",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            }
                          ],
                          "rowLimit": 10000,
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "TotalEstimatedCost",
                              "subscriptionId"
                            ]
                          },
                          "labelSettings": [
                            {
                              "columnId": "id",
                              "label": "Resource Name"
                            },
                            {
                              "columnId": "TotalEstimatedCost",
                              "label": "Subscription"
                            },
                            {
                              "columnId": "EstimatedMonthlyPrice",
                              "label": "Estimated Monthly Price"
                            }
                          ]
                        }
                      },
                      "name": "SQLDB query"
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "SQLResources",
                  "comparison": "isEqualTo",
                  "value": "Databases"
                },
                "name": "SQLDB"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedView",
            "comparison": "isEqualTo",
            "value": "SQL"
          },
          "name": "Databases"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "Azure Security Center"
      ],
      "fromTemplateId": "DefenderForCloudPriceEstimation"
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}